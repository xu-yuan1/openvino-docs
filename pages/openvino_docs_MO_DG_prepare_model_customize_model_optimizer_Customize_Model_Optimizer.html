
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Model Optimizer Extensibility &#8212; OpenVINO™  documentation</title>
    
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <link href="../_static/css/media/favicon.ico" rel="shortcut icon">
    <link rel="stylesheet" href="../_static/css/openvino_sphinx_theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/input.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/textfield.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    <script src="../_static/js/openvino_sphinx_theme.js"></script>
    <link rel="stylesheet" href="../_static/css/viewer.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-barchart-background@1.3.0/build/Plugin.Barchart.Background.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
    <script src="../_static/js/viewer.min.js"></script>
    <script src="/assets/versions_raw.js"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/custom.js"></script>
    <script src="../_static/js/graphs.js"></script>
    <script src="../_static/js/graphs_ov_tf.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/target-highlight.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://docs.openvino.ai/latest/pages/openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Customize_Model_Optimizer.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extending Model Optimizer with Caffe Python Layers" href="openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Extending_Model_Optimizer_With_Caffe_Python_Layers.html" />
    <link rel="prev" title="How to Implement Custom Layers for VPU (Intel® Neural Compute Stick 2)" href="openvino_docs_Extensibility_UG_VPU_Kernel.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
      <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="get_started.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="documentation.html">
  Documentation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorials.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../model_zoo.html">
  Model Zoo
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="resources.html">
  Resources
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/openvinotoolkit/openvino" rel="noopener" target="_blank" title="GitHub">
            <span><i class="sst-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
</ul>
      </div>
      
      <div class="navbar-end-item">
        
<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="version-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
  <div class="dropdown-menu" aria-labelledby="version-selector">
  </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        

<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="language-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</button>
  <div class="dropdown-menu" aria-labelledby="language-selector">
    
      
        <a class="dropdown-item font-weight-bold" href="/latest/pages/openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Customize_Model_Optimizer.html">English</a>
      
    
      
        <a  class="dropdown-item" href="/cn/latest/pages/openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Customize_Model_Optimizer.html">Chinese</a>
      
    
  </div>
</div>

      </div>
      
    </div>
  </div>
</div>
        <div id="collapse-nav-wrapper" class="container-xl">
          <button id="collapse-nav" class="button bttn-prm button-size-m" type="button" data-toggle="collapse" data-target="#nav-tree" aria-expanded="false" aria-controls="nav-tree">
            Documentation navigation <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </nav>
      <div class="transition-banner container-fluid alert alert-info alert-dismissible fade show" role="alert">
        <p>OpenVINO 2022.1 introduces a new version of OpenVINO API (API 2.0). For more information on the changes and transition steps, see the <a href="https://docs.openvino.ai/latest/openvino_2_0_transition_guide.html">transition guide</a></p>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
    </div>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar" id="nav-tree"><form class="searchForm bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="icon fas fa-search"></i>
    <input type="search" class="form-control" name="query" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API 2.0
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_2_0_transition_guide.html">
   OpenVINO™ API 2.0 Transition Guide
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_2_0_deployment.html">
     Installation &amp; Deployment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_2_0_inference_pipeline.html">
     Inference Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_2_0_configure_devices.html">
     Configuring Devices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_2_0_preprocessing.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_2_0_model_creation.html">
     Model Creation in OpenVINO™ Runtime
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Converting and Preparing Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_model_processing_introduction.html">
   Introduction to Model Processing
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_MO_DG_Deep_Learning_Model_Optimizer_DevGuide.html">
   Converting Models with Model Optimizer
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Converting_Model.html">
     Setting Input Shapes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_Model_Optimization_Techniques.html">
     Model Optimization Techniques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Cutting_Model.html">
     Cutting Off Parts of a Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_Additional_Optimization_Use_Cases.html">
     Embedding Preprocessing Computation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_FP16_Compression.html">
     Compressing a Model to FP16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_TensorFlow.html">
     Converting a TensorFlow Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_ONNX.html">
     Converting an ONNX Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_PyTorch.html">
     Converting a PyTorch Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_Paddle.html">
     Converting a PaddlePaddle Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_MxNet.html">
     Converting an MXNet Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_Caffe.html">
     Converting a Caffe Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Convert_Model_From_Kaldi.html">
     Converting a Kaldi Model
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tutorials.html">
     Model Conversion Tutorials
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_AttentionOCR_From_Tensorflow.html">
       Converting a TensorFlow Attention OCR Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_BERT_From_Tensorflow.html">
       Converting a TensorFlow BERT Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_CRNN_From_Tensorflow.html">
       Converting a TensorFlow CRNN Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_DeepSpeech_From_Tensorflow.html">
       Converting a TensorFlow DeepSpeech Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_EfficientDet_Models.html">
       Converting TensorFlow EfficientDet Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_FaceNet_From_Tensorflow.html">
       Converting TensorFlow FaceNet Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_GNMT_From_Tensorflow.html">
       Converting a TensorFlow GNMT Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_lm_1b_From_Tensorflow.html">
       Converting a TensorFlow Language Model on One Billion Word Benchmark
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_NCF_From_Tensorflow.html">
       Converting a TensorFlow Neural Collaborative Filtering Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_Object_Detection_API_Models.html">
       Converting TensorFlow Object Detection API Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_RetinaNet_From_Tensorflow.html">
       Converting a TensorFlow RetinaNet Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_Slim_Library_Models.html">
       Converting TensorFlow Slim Image Classification Model Library Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_WideAndDeep_Family_Models.html">
       Converting TensorFlow Wide and Deep Family Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_XLNet_From_Tensorflow.html">
       Converting a TensorFlow XLNet Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_YOLO_From_Tensorflow.html">
       Converting TensorFlow YOLO Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_onnx_specific_Convert_Faster_RCNN.html">
       Converting an ONNX Faster R-CNN Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_onnx_specific_Convert_GPT2.html">
       Converting an ONNX GPT-2 Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_onnx_specific_Convert_Mask_RCNN.html">
       Converting an ONNX Mask R-CNN Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_Bert_ner.html">
       Converting a PyTorch BERT-NER Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_Cascade_RCNN_res101.html">
       Converting a PyTorch Cascade RCNN R-101 Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_F3Net.html">
       Converting a PyTorch F3Net Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_QuartzNet.html">
       Converting a PyTorch QuartzNet Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_RCAN.html">
       Converting a PyTorch RCAN Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_RNNT.html">
       Converting a PyTorch RNN-T Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_pytorch_specific_Convert_YOLACT.html">
       Converting a PyTorch YOLACT Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_mxnet_specific_Convert_GluonCV_Models.html">
       Converting MXNet GluonCV Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_mxnet_specific_Convert_Style_Transfer_From_MXNet.html">
       Converting an MXNet Style Transfer Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_kaldi_specific_Aspire_Tdnn_Model.html">
       Converting a Kaldi ASpIRE Chain Time Delay Neural Network (TDNN) Model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_Model_Optimizer_FAQ.html">
     Model Optimizer Frequently Asked Questions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Optimization and Performance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_optimization_guide_dldt_optimization_guide.html">
   Introduction to Performance Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_MO_DG_Getting_Performance_Numbers.html">
   Getting Performance Numbers
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_model_optimization_guide.html">
   Model Optimization Guide
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="pot_introduction.html">
     Optimizing models post-training
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="pot_default_quantization_usage.html">
       Quantizing Model
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="pot_compression_algorithms_quantization_default_README.html">
         DefaultQuantization Method
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="pot_accuracyaware_usage.html">
       Quantizing Model with Accuracy Control
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="accuracy_aware_README.html">
         AccuracyAwareQuantization Method
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="pot_docs_BestPractices.html">
       Quantization Best Practices
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="pot_saturation_issue.html">
         Saturation Issue
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="pot_compression_api_README.html">
       API Reference
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="pot_compression_cli_README.html">
       Command-line Interface
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="pot_docs_simplified_mode.html">
         Simplified Mode
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="pot_configs_README.html">
         Configuration File Description
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="pot_examples_description.html">
       Examples
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4 has-children">
        <a class="reference internal" href="pot_example_README.html">
         API Examples
        </a>
        <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
        <label for="toctree-checkbox-11">
         <i class="fas fa-chevron-down">
         </i>
        </label>
        <ul>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_classification_README.html">
           Quantizatiing Image Classification Model
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_object_detection_README.html">
           Quantizatiing Object Detection Model with Accuracy Control
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_face_detection_README.html">
           Quantizatiing Cascaded Model
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_segmentation_README.html">
           Quantizatiing Semantic Segmentation Model
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_3d_segmentation_README.html">
           Quantizatiing 3D Segmentation Model
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="pot_example_speech_README.html">
           Quantizatiing for GNA Device
          </a>
         </li>
        </ul>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="pot_configs_examples_README.html">
         Command-line Example
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="pot_docs_FrequentlyAskedQuestions.html">
       Post-training Optimization Tool Frequently Asked Questions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="docs_nncf_introduction.html">
     Neural Network Compression Framework
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pot_range_supervision_README.html">
     (Experimental) Protecting Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_deployment_optimization_guide_dldt_optimization_guide.html">
   Runtime Inference Optimizations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_deployment_optimization_guide_common.html">
     General Optimizations
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_deployment_optimization_guide_latency.html">
     Optimizing for the Latency
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Model_caching_overview.html">
       Model Caching Overview
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_deployment_optimization_guide_tput.html">
     Optimizing for Throughput
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_deployment_optimization_guide_tput_advanced.html">
     Using Advanced Throughput Options: Streams and Batching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_deployment_optimization_guide_internals.html">
     Further Low-Level Implementation Details
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_tuning_utilities.html">
   Tuning Utilities
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_inference_engine_tools_cross_check_tool_README.html">
     Cross Check Tool
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_performance_benchmarks.html">
   Performance Benchmarks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_performance_benchmarks_openvino.html">
     Intel® Distribution of OpenVINO™ toolkit Benchmark Results
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_performance_benchmarks_faq.html">
       Performance Information Frequently Asked Questions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://docs.openvino.ai/downloads/benchmark_files/OV-2022.1-Download-Excel.xlsx">
       Download Performance Data Spreadsheet in MS Excel Format
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_performance_int8_vs_fp32.html">
       Model Accuracy for INT8 and FP32 Precision
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_performance_benchmarks_ovms.html">
     OpenVINO™ Model Server Benchmark Results
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Deploying Inference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_deployment_guide_introduction.html">
   Introduction to OpenVINO™ Deployment
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_OV_UG_OV_Runtime_User_Guide.html">
   Performing Inference with OpenVINO Runtime
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_OV_UG_Integrate_OV_with_your_application.html">
     Integrate OpenVINO™ with Your Application
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Model_Representation.html">
       Model Representation in OpenVINO™ Runtime
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Infer_request.html">
       OpenVINO™ Inference Request
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Python_API_exclusives.html">
       OpenVINO™ Python API Exclusives
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_ShapeInference.html">
     Changing Input Shapes
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_OV_UG_Working_with_devices.html">
     Working with devices
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_query_api.html">
       Query Device Properties - Configuration
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_CPU.html">
       CPU Device
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_GPU.html">
       GPU Device
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
      <label for="toctree-checkbox-20">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_GPU_RemoteTensor_API.html">
         Remote Tensor API of GPU Plugin
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_VPU.html">
       VPU Devices
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
      <label for="toctree-checkbox-21">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_MYRIAD.html">
         MYRIAD Device
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_HDDL.html">
         HDDL Device
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_GNA.html">
       GNA Device
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_ARM_CPU.html">
       Arm® CPU Device
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_OV_UG_Preprocessing_Overview.html">
     Optimize Preprocessing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
    <label for="toctree-checkbox-22">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Preprocessing_Details.html">
       Preprocessing API - details
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Layout_Overview.html">
       Layout API Overview
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_Preprocess_Usecase_save.html">
       Use Case - Integrate and Save Preprocessing Steps Into IR
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_OV_UG_DynamicShapes.html">
     Dynamic Shapes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
    <label for="toctree-checkbox-23">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_NoDynamicShapes.html">
       When Dynamic Shapes API is Not Applicable
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_AUTO.html">
     Automatic Device Selection
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
    <label for="toctree-checkbox-24">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_OV_UG_supported_plugins_AUTO_debugging.html">
       Debugging Auto-Device Plugin
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_Running_on_multiple_devices.html">
     Running on Multiple Devices Simultaneously
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_Hetero_execution.html">
     Heterogeneous execution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_Performance_Hints.html">
     High-level Performance Hints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_Automatic_Batching.html">
     Automatic Batching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_OV_UG_network_state_intro.html">
     Stateful models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_deployment_guide.html">
   Deploying Your Applications with OpenVINO™
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_install_guides_deployment_manager_tool.html">
     Deploying Your Application with Deployment Manager
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_deploy_local_distribution.html">
     Libraries for Local Distribution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_inference_engine_tools_compile_tool_README.html">
   Compile Tool
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  THE Ecosystem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ovsa_get_started.html">
   OpenVINO™ Security Add-on
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="workbench_docs_Workbench_DG_Introduction.html">
   OpenVINO™ Deep Learning Workbench Overview
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
  <label for="toctree-checkbox-26">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="workbench_docs_Workbench_DG_Install.html">
     Installation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
    <label for="toctree-checkbox-27">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Prerequisites.html">
       Prerequisites
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Run_Locally.html">
       Run the DL Workbench Locally
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
      <label for="toctree-checkbox-28">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Advanced_Configurations.html">
         Advanced DL Workbench Configurations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Docker_Container.html">
         Work with Docker Container
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Start_DL_Workbench_in_DevCloud.html">
       Run the DL Workbench in the Intel® DevCloud for the Edge
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="workbench_docs_Workbench_DG_Work_with_Models_and_Sample_Datasets.html">
     Get Started
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
    <label for="toctree-checkbox-29">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Select_Model.html">
       Import Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_Create_Project.html">
       Create Project
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Additional_Resources.html">
       Educational Resources about DL Workbench
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
      <label for="toctree-checkbox-30">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Key_Concepts.html">
         DL Workbench Key Concepts
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorials.html">
     Tutorials
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
    <label for="toctree-checkbox-31">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Import_YOLO.html">
       Object Detection Model (YOLOv4)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Measure_Accuracy_Object_detection.html">
       Object Detection Model (SSD_mobilenet)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Classification.html">
       Classification Model (mobilenet)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Measure_Accuracy_Classification.html">
       Classification Model (squeezenet)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Instance_Segmentation.html">
       Instance Segmentation Model (mask R-cnn)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Semantic_Segmentation.html">
       Semantic Segmentation Model (deeplab)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Style_Transfer.html">
       Style Transfer Model (fast-nst-onnx)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_NLP.html">
       NLP Model (BERT)
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="workbench_docs_Workbench_DG_User_Guide.html">
     User Guide
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
    <label for="toctree-checkbox-32">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Select_Models.html">
       Obtain Models
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
      <label for="toctree-checkbox-33">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_OMZ_Models.html">
         Import Open Model Zoo Models
        </a>
       </li>
       <li class="toctree-l4 has-children">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Original_Model_Import.html">
         Import Original Model
        </a>
        <input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/>
        <label for="toctree-checkbox-34">
         <i class="fas fa-chevron-down">
         </i>
        </label>
        <ul>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Tutorial_Import_Original.html">
           Import Original Model Recommendations
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Generate_Datasets.html">
       Obtain Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/>
      <label for="toctree-checkbox-35">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4 has-children">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Dataset_Types.html">
         Dataset Types
        </a>
        <input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/>
        <label for="toctree-checkbox-36">
         <i class="fas fa-chevron-down">
         </i>
        </label>
        <ul>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Download_and_Cut_Datasets.html">
           Cut Datasets
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Select_Environment.html">
       Select Environment
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/>
      <label for="toctree-checkbox-37">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4 has-children">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Remote_Profiling.html">
         Work with Remote Targets
        </a>
        <input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/>
        <label for="toctree-checkbox-38">
         <i class="fas fa-chevron-down">
         </i>
        </label>
        <ul>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Profile_on_Remote_Machine.html">
           Profile on Remote Machine
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Setup_Remote_Target.html">
           Set Up Remote Target
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Add_Remote_Target.html">
           Register Remote Target in DL Workbench
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="workbench_docs_Workbench_DG_Remote_Machines.html">
           Manipulate Remote Machines
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Int_8_Quantization.html">
       Optimize Model Performance
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Run_Inference.html">
       Explore Inference Configurations
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/>
      <label for="toctree-checkbox-39">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Run_Single_Inference.html">
         Run Inference
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_View_Inference_Results.html">
         View Inference Results
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Compare_Performance_between_Two_Versions_of_Models.html">
         Compare Performance between Two Versions of a Model
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Visualize_Model.html">
         Visualize Model
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Visualize_Accuracy.html">
       Visualize Model Output
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Measure_Accuracy.html">
       Create Accuracy Report
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" type="checkbox"/>
      <label for="toctree-checkbox-40">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Accuracy_Configuration.html">
         Accuracy Configuration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Configure_Accuracy_Settings.html">
         Set Accuracy Configuration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Accuracy_Report_Results.html">
         Interpret Accuracy Report Results
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Deployment_Package.html">
       Create Deployment Package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" type="checkbox"/>
      <label for="toctree-checkbox-41">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Deploy_and_Integrate_Performance_Criteria_into_Application.html">
         Deploy and Integrate Performance Criteria into Application
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Export_Project.html">
       Export Project
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Jupyter_Notebooks_CLI.html">
       Learn OpenVINO in DL Workbench
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" type="checkbox"/>
      <label for="toctree-checkbox-42">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Jupyter_Notebooks.html">
         Learn Model Inference with OpenVINO™ API in JupyterLab* Environment
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_Persist_Database.html">
       Restore DL Workbench State
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="workbench_docs_security_Workbench.html">
       Run DL Workbench Securely
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" type="checkbox"/>
      <label for="toctree-checkbox-43">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Authentication.html">
         Enable Authentication in DL Workbench
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="workbench_docs_Workbench_DG_Configure_TLS.html">
         Configure Transport Layer Security (TLS)
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="workbench_docs_Workbench_DG_Troubleshooting.html">
     Troubleshooting
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" type="checkbox"/>
    <label for="toctree-checkbox-44">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="workbench_docs_Workbench_DG_DC_Troubleshooting.html">
       Troubleshooting for DL Workbench in the Intel® DevCloud for the Edge
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Media Processing and Computer Vision Libraries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_dlstreamer.html">
   Intel® Deep Learning Streamer
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_gapi_gapi_intro.html">
   Introduction to OpenCV Graph API (G-API)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" type="checkbox"/>
  <label for="toctree-checkbox-45">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_gapi_kernel_api.html">
     Graph API Kernel API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_gapi_face_beautification.html">
     Implementing a Face Beautification Algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_gapi_gapi_face_analytics_pipeline.html">
     Building a Face Analytics Pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://docs.opencv.org/master/">
   OpenCV* Developer Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://software.intel.com/en-us/openclsdk-devguide">
   OpenCL™ Developer Guide
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  OpenVINO Extensibility
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="openvino_docs_Extensibility_UG_Intro.html">
   OpenVINO Extensibility Mechanism
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" type="checkbox"/>
  <label for="toctree-checkbox-46">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_add_openvino_ops.html">
     Custom OpenVINO™ Operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_Frontend_Extensions.html">
     Frontend Extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_GPU.html">
     How to Implement Custom GPU Operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_VPU_Kernel.html">
     How to Implement Custom Layers for VPU (Intel® Neural Compute Stick 2)
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="current reference internal" href="#">
     Model Optimizer Extensibility
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" type="checkbox"/>
    <label for="toctree-checkbox-47">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Extending_Model_Optimizer_With_Caffe_Python_Layers.html">
       Extending Model Optimizer with Caffe Python Layers
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_transformations.html">
   Overview of Transformations API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" type="checkbox"/>
  <label for="toctree-checkbox-48">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_model_pass.html">
     OpenVINO Model Pass
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_matcher_pass.html">
     OpenVINO Matcher Pass
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_Extensibility_UG_graph_rewrite_pass.html">
     OpenVINO Graph Rewrite Pass
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openvino_docs_ie_plugin_dg_overview.html">
   OpenVINO Plugin Developer Guide
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" type="checkbox"/>
  <label for="toctree-checkbox-49">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_plugin.html">
     Implement Plugin Functionality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_executable_network.html">
     Implement Executable Network Functionality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_infer_request.html">
     Implement Synchronous Inference Request
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_async_infer_request.html">
     Implement Asynchronous Inference Request
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_plugin_build.html">
     Build Plugin Using CMake*
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="openvino_docs_ie_plugin_dg_plugin_testing.html">
     Plugin Testing
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_ie_plugin_detailed_guides.html">
     Advanced Topics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" type="checkbox"/>
    <label for="toctree-checkbox-50">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="openvino_docs_ie_plugin_dg_quantized_networks.html">
       Quantized networks compute and restrictions
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="openvino_docs_OV_UG_lpt.html">
       OpenVINO™ Low Precision Transformations
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" type="checkbox"/>
      <label for="toctree-checkbox-51">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4 has-children">
        <a class="reference internal" href="openvino_docs_OV_UG_lpt_attributes.html">
         Attributes
        </a>
        <input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" type="checkbox"/>
        <label for="toctree-checkbox-52">
         <i class="fas fa-chevron-down">
         </i>
        </label>
        <ul>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_AvgPoolPrecisionPreserved.html">
           AvgPoolPrecisionPreserved
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_IntervalsAlignment.html">
           IntervalsAlignment
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_PrecisionPreserved.html">
           PrecisionPreserved
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_Precisions.html">
           Precisions
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_QuantizationAlignment.html">
           QuantizationAlignment
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="openvino_docs_OV_UG_lpt_QuantizationGranularity.html">
           QuantizationGranularity
          </a>
         </li>
        </ul>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_lpt_step1_prerequisites.html">
         Step 1. Prerequisites transformations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_lpt_step2_markup.html">
         Step 2. Markup transformations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_lpt_step3_main.html">
         Step 3. Main transformations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="openvino_docs_OV_UG_lpt_step4_cleanup.html">
         Step 4. Cleanup transformations
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="openvino_docs_ie_plugin_api_references.html">
     Plugin API Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" type="checkbox"/>
    <label for="toctree-checkbox-53">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="simple">
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Use OpenVINO™ Toolkit Securely
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_security_guide_introduction.html">
   Introduction to OpenVINO™ Security
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_security_guide_workbench.html">
   Deep Learning Workbench Security
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="openvino_docs_OV_UG_protecting_model_guide.html">
   Using Encrypted Models with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ovsa_get_started.html">
   OpenVINO™ Security Add-on
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Model Representation in Memory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-conversion-pipeline">
   Model Conversion Pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-loading">
     Model Loading
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operations-attributes-extracting">
     Operations Attributes Extracting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#front-phase">
     Front Phase
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partial-inference">
     Partial Inference
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Middle Phase
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nhwc-to-nchw-layout-change">
     NHWC to NCHW Layout Change
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#back-phase">
     Back Phase
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intermediate-representation-emitting">
     Intermediate Representation Emitting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#graph-traversal-and-modification-using-ports-and-connections">
   Graph Traversal and Modification Using Ports and Connections
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ports">
     Ports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#connections">
     Connections
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-optimizer-extensions">
   Model Optimizer Extensions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-optimizer-operation">
     Model Optimizer Operation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operation-extractor">
     Operation Extractor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graph-transformation-extensions">
     Graph Transformation Extensions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       Front Phase Transformations
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#pattern-defined-front-phase-transformations">
         Pattern-Defined Front Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#specific-operation-front-phase-transformations">
         Specific Operation Front Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#generic-front-phase-transformations">
         Generic Front Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#node-name-pattern-front-phase-transformations">
         Node Name Pattern Front Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#front-phase-transformations-using-start-and-end-points">
         Front Phase Transformations Using Start and End Points
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#generic-front-phase-transformations-enabled-with-transformations-configuration-file">
         Generic Front Phase Transformations Enabled with Transformations Configuration File
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#middle-phase-transformations">
       Middle Phase Transformations
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#pattern-defined-middle-phase-transformations">
         Pattern-Defined Middle Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#generic-middle-phase-transformations">
         Generic Middle Phase Transformations
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#back-phase-transformations">
       Back Phase Transformations
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id20">
         Pattern-Defined Back Phase Transformations
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#generic-back-phase-transformations">
         Generic Back Phase Transformations
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-also">
   See Also
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                <div class="tocsection download-docs">
  <div class="dropdown sst-dropdown">
    <button class="button bttn-prm button-size-m" data-display="static" type="button" id="download-options"
      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Download Docs
    </button>
    <div class="dropdown-menu" aria-labelledby="download-options">
      <a class="dropdown-item" href="#" onclick="window.print()">.pdf</a>
      <a id="download-zip-btn" class="dropdown-item" href="#">.zip</a>
    </div>
  </div>
</div>
              </div>
              
            
          </div>
          

          
          
              
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">

<div class="tocsection editthispage">
    <a href="None">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

            
                <div>
                  
  <section id="model-optimizer-extensibility">
<span id="doxid-openvino-docs-m-o-d-g-prepare-model-customize-model-optimizer-customize-model-optimizer"></span><span id="index-0"></span><h1>Model Optimizer Extensibility<a class="headerlink" href="#model-optimizer-extensibility" title="Permalink to this headline">¶</a></h1>
<p><span class="target" id="doxid-openvino-docs-m-o-d-g-prepare-model-customize-model-optimizer-customize-model-optimizer-1md-openvino-docs-mo-dg-prepare-model-customize-model-optimizer-customize-model-optimizer"></span></p>
<div class="toctree-wrapper compound">
</div>
<p><span class="target" id="doxid-openvino-docs-m-o-d-g-prepare-model-customize-model-optimizer-customize-model-optimizer-1model-optimizer-extensibility"></span> Model Optimizer extensibility mechanism enables support of new operations and custom transformations to generate the optimized intermediate representation (IR) as described in the <a class="reference internal" href="openvino_docs_MO_DG_IR_and_opsets.html#doxid-openvino-docs-m-o-d-g-i-r-and-opsets"><span class="std std-ref">Deep Learning Network Intermediate Representation and Operation Sets in OpenVINO™</span></a>. This mechanism is a core part of Model Optimizer, as a huge set of examples showing how to add custom logic to support your model.</p>
<p>There are several cases when the customization is needed:</p>
<ul class="simple">
<li><p>A model contains operation(s) not known for the Model Optimizer, but these operation(s) could be expressed as a combination of supported operations. In this case, a custom transformation should be implemented to replace unsupported operation(s) with supported ones.</p></li>
<li><p>A model contains a sub-graph of operations that can be replaced with a smaller number of operations to get better performance. This example corresponds to so-called <em>fusing transformations</em>, for example, replacing a sub-graph performing the calculation <span class="math notranslate nohighlight">\(x / (1.0 + e^{-(beta \* x)})\)</span> with a single operation of type <a class="reference internal" href="openvino_docs_ops_activation_Swish_4.html#doxid-openvino-docs-ops-activation-swish-4"><span class="std std-ref">Swish</span></a>.</p></li>
<li><p>A model contains a custom framework operation (the operation that is not a part of an official operation set of the framework) that was developed using the framework extensibility mechanism. In this case, Model Optimizer should know how to handle the operation and generate a corresponding section in an IR for it.</p></li>
</ul>
<p>It is necessary to figure out how Model Optimizer represents a model in a memory and converts it to an IR before going into details of the Model Optimizer extensibility mechanism.</p>
<div class="admonition note" id="model-representation-in-memory">
<p class="admonition-title">Note</p>
<p>All paths in this article are provided relatively to the Model Optimizer installation directory if not stated otherwise.</p>
</div>
<section id="id1">
<h2>Model Representation in Memory<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The model can be represented as a directed graph, where nodes are operations and edges correspond to data passing from a producer operation (node) to a consumer operation (node).</p>
<p>Model Optimizer uses Python class <code class="docutils literal notranslate"><span class="pre">mo.graph.graph.Graph</span></code> instance to represent the computation graph in memory during the model conversion. This class is inherited from the <code class="docutils literal notranslate"><span class="pre">networkx.MultiDiGraph</span></code> class of the standard <code class="docutils literal notranslate"><span class="pre">networkx</span></code> Python library. It provides many convenient methods to traverse and modify the graph. For the examples, refer to the <code class="docutils literal notranslate"><span class="pre">mo/graph/graph.py</span></code> file.</p>
<p>Model Optimizer keeps all necessary information about the operation in node attributes. Model Optimizer uses the <code class="docutils literal notranslate"><span class="pre">mo.graph.graph.Node</span></code> class defined in the <code class="docutils literal notranslate"><span class="pre">mo/graph/graph.py</span></code> file, which is a wrapper on top of a <code class="docutils literal notranslate"><span class="pre">networkx</span></code> node attributes dictionary, and provides many convenient methods to work with the node. For example, the node <code class="docutils literal notranslate"><span class="pre">my_node</span></code> attribute with a name ‘my_attr <code class="docutils literal notranslate"><span class="pre">can</span> <span class="pre">be</span> <span class="pre">retrieved</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">node</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">following</span> <span class="pre">code</span></code> my_node.my_attr&lt;tt&gt;, which is equivalent to obtaining attribute with name’my_attr’ <code class="docutils literal notranslate"><span class="pre">in</span> <span class="pre">the</span></code> graph.node[‘my_node’] <code class="docutils literal notranslate"><span class="pre">dictionary.</span> <span class="pre">For</span> <span class="pre">the</span> <span class="pre">class</span> <span class="pre">implementation</span> <span class="pre">details,</span> <span class="pre">refer</span> <span class="pre">to</span> <span class="pre">the</span></code> mo/graph/graph.py` file.</p>
<p>An operation may have several inputs and outputs. For example, operation <a class="reference internal" href="openvino_docs_ops_movement_Split_1.html#doxid-openvino-docs-ops-movement-split-1"><span class="std std-ref">Split</span></a> has two inputs: data to split and axis to split along, and variable number of outputs depending on a value of attribute <code class="docutils literal notranslate"><span class="pre">num_splits</span></code>. Each input data to the operation is passed to a specific operation <strong>input port</strong>. An operation produces the output data from an <strong>output port</strong>. Input and output ports are numbered from 0 independently. Model Optimizer uses classes <code class="docutils literal notranslate"><span class="pre">mo.graph.port.Port</span></code> and <code class="docutils literal notranslate"><span class="pre">mo.graph.connection.Connection</span></code>, which are useful abstraction to perform graph modifications like nodes connecting/re-connecting and graph traversing. These classes are widely used in the Model Optimizer code so it is easy to find a lot of usage examples.</p>
<p>There is no dedicated class corresponding to an edge, so low-level graph manipulation is needed to get access to edge attributes if needed. Meanwhile, most manipulations with nodes connections should be done with help of the <code class="docutils literal notranslate"><span class="pre">mo.graph.connection.Connection</span></code> and <code class="docutils literal notranslate"><span class="pre">mo.graph.port.Port</span></code> classes. Thus, low-level graph manipulation is error prone and is strongly not recommended.</p>
<p>Further details and examples related to a model representation in memory are provided in the sections below, in a context for a better explanation. Also, for more information on how to use ports and connections, refer to the <a class="reference external" href="#graph-ports-and-conneсtions">Graph Traversal and Modification Using s and s</a> section.</p>
</section>
<section id="model-conversion-pipeline">
<span id="id2"></span><h2>Model Conversion Pipeline<a class="headerlink" href="#model-conversion-pipeline" title="Permalink to this headline">¶</a></h2>
<p>A model conversion pipeline can be represented with the following diagram:</p>
<img alt="Model Conversion pipeline" src="../_images/MO_conversion_pipeline.png" />
<p>Each conversion step is reviewed in details below.</p>
<section id="model-loading">
<span id="id3"></span><h3>Model Loading<a class="headerlink" href="#model-loading" title="Permalink to this headline">¶</a></h3>
<p>Model Optimizer gets a trained model file as an input. The model loader component of Model Optimizer reads a model file using Python bindings provided with the framework and builds an in-memory representation of a computation graph. There is a separate loader for each supported framework. These loaders are implemented in the <code class="docutils literal notranslate"><span class="pre">extensions/load/&lt;FRAMEWORK&gt;/loader.py</span></code> files of Model Optimizer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Model Optimizer uses a special parser for Caffe models built on top of the <code class="docutils literal notranslate"><span class="pre">caffe.proto</span></code> file. In the case of a model loading failure, Model Optimizer throws an error and requests preparation of the parser that can read the model. For more information on how to prepare the custom Caffe parser, refer to the <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_Model_Optimizer_FAQ.html#doxid-openvino-docs-m-o-d-g-prepare-model-model-optimizer-f-a-q"><span class="std std-ref">Model Optimizer Frequently Asked Questions #1</span></a>.</p>
</div>
<p>The result of a model loading step is a <code class="docutils literal notranslate"><span class="pre">Graph</span></code> object, which can be depicted like in the following example:</p>
<img alt="Graph After Load" src="../_images/MO_graph_after_loader.png" />
<p>Model Optimizer loader saves an operation instance framework description (usually it is a Protobuf message) into a node attribute usually with a name <code class="docutils literal notranslate"><span class="pre">pb</span></code> for each operation of an input model. It is important that this is a <strong>framework-specific</strong> description of an operation. This means that an operation, for example, <a class="reference internal" href="openvino_docs_ops_convolution_Convolution_1.html#doxid-openvino-docs-ops-convolution-convolution-1"><span class="std std-ref">Convolution</span></a> may be represented differently in, for example, Caffe and TensorFlow frameworks but performs the same calculations from a mathematical point of view.</p>
<p>In the example above, the “Operation 2” has one input and two outputs. The tensor produced from the output “port 0” is consumed with the “Operation 5” (the input “port 0”) and “Operation 3” (the input “port 1”). The tensor produced from the output “port 1” is consumed with the “Operation 4” (the input “port 0”).</p>
<p>Each edge has two attributes <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code> containing the input port number of the consumer node and the output port number of the producer node. These attributes describe the fact that nodes are operations consuming some input tensors and producing some output tensors. From the perspective of Model Optimizer, nodes themselves are “black boxes” because they do not contain required information about the operation they perform.</p>
</section>
<section id="operations-attributes-extracting">
<span id="id4"></span><h3>Operations Attributes Extracting<a class="headerlink" href="#operations-attributes-extracting" title="Permalink to this headline">¶</a></h3>
<p>The next step is to parse framework-dependent operation representation saved in a node attribute and update the node attributes with the operation specific attributes. There are three options to do this.</p>
<ol class="arabic simple">
<li><p>The extractor extension approach. This is a recommended way to extract attributes for an operation and it is explained in details in the <a class="reference external" href="#extension-extractor">Operation Extractor</a> section.</p></li>
<li><p>The legacy approach with a built-in extractor. The <code class="docutils literal notranslate"><span class="pre">mo/front/&lt;FRAMEWORK&gt;/extractor.py</span></code> file (for example, the one for Caffe) defines a dictionary with extractors for specific operation types. A key in the dictionary is a type of an operation to trigger the extracting function for and the value is the function. The function has one parameter – a node to extract attributes from. This is a legacy and non-extensible approach so it should be avoided. This mechanism will be removed in future versions of Model Optimizer.</p></li>
</ol>
<p>The extractors execution order is the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CustomLayersMapping.xml</span></code> (for Caffe models only).</p></li>
<li><p>Model Optimizer extension.</p></li>
<li><p>Built-in Model Optimizer extractor.</p></li>
</ul>
<p>The result of operations attributes extracting step can be depicted like in the following example:</p>
<img alt="Graph After Attributes Extraction" src="../_images/MO_graph_after_extractors.png" />
<p>The only difference in the graph from the previous step is that nodes contain dictionary with extracted attributes and operation-specific attributes needed for Model Optimizer. However, starting from this step, Model Optimizer does not need the original representation of the operation/model and uses just Model Optimizer representation (there are some peculiar cases in which Model Optimizer still uses the <code class="docutils literal notranslate"><span class="pre">pb</span></code> attribute, covered in this article partially). A detailed list of common node attributes and their values is provided below in the <a class="reference external" href="#extension-operation">Model Optimizer Operation</a> section.</p>
</section>
<section id="front-phase">
<span id="id5"></span><h3>Front Phase<a class="headerlink" href="#front-phase" title="Permalink to this headline">¶</a></h3>
<p>For legacy reasons, you must specify shapes for all not fully-defined inputs of the model. In contrast, other machine learning frameworks, like TensorFlow, let you create a model with undefined or partially defined input shapes. As an example, undefined dimension is marked with an integer value <code class="docutils literal notranslate"><span class="pre">-1</span></code> in a TensorFlow model or has some string name in an ONNX model.</p>
<p>During the front phase, Model Optimizer knows shape of the model inputs and constants only and does not know shapes (and even ranks) of the intermediate tensors. But information about shapes may not be needed to implement particular transformation. For example, the transformation <code class="docutils literal notranslate"><span class="pre">extensions/front/TopKNormalize.py</span></code> removes an attribute <code class="docutils literal notranslate"><span class="pre">k</span></code> from a <code class="docutils literal notranslate"><span class="pre">TopK</span></code> node and adds an input constant with the value <code class="docutils literal notranslate"><span class="pre">k</span></code>. The transformation is needed to convert a <code class="docutils literal notranslate"><span class="pre">TopK</span></code> operation. It comes from frameworks, where a number of output elements is defined as an attribute of the operation to the OpenVINO <a class="reference internal" href="openvino_docs_ops_sort_TopK_3.html#doxid-openvino-docs-ops-sort-top-k-3"><span class="std std-ref">TopK</span></a> operation semantic, which requires this value to be a separate input.</p>
<p>It is important to mention that sometimes it seems like transformation cannot be implemented during the front phase because the actual values of inputs or shapes are needed. In fact, manipulations of shapes or values can be implemented using operations that are added to the graph. Consider the <code class="docutils literal notranslate"><span class="pre">extensions/front/onnx/flattenONNX_to_reshape.py</span></code> transformation, which replaces an ONNX <a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md#Flatten">Flatten</a> operation with a sub-graph of operations performing the following (when <code class="docutils literal notranslate"><span class="pre">axis</span></code> is not equal to 0 and 1):</p>
<ol class="arabic simple">
<li><p>Calculate a shape of the <code class="docutils literal notranslate"><span class="pre">Flatten</span></code> input tensor, using the <a class="reference internal" href="openvino_docs_ops_shape_ShapeOf_3.html#doxid-openvino-docs-ops-shape-shape-of-3"><span class="std std-ref">ShapeOf</span></a> operation.</p></li>
<li><p>Get the first <code class="docutils literal notranslate"><span class="pre">axis</span></code> elements from the output of <code class="docutils literal notranslate"><span class="pre">Shape</span></code> operation and calculate their product, using the <a class="reference internal" href="openvino_docs_ops_reduction_ReduceProd_1.html#doxid-openvino-docs-ops-reduction-reduce-prod-1"><span class="std std-ref">ReduceProd</span></a> operation.</p></li>
<li><p>Concatenate output of the <code class="docutils literal notranslate"><span class="pre">ReduceProd</span></code> and constant with the value of <code class="docutils literal notranslate"><span class="pre">-1</span></code> (for an explanation of this value refer to the <a class="reference internal" href="openvino_docs_ops_shape_Reshape_1.html#doxid-openvino-docs-ops-shape-reshape-1"><span class="std std-ref">Reshape</span></a> specification page).</p></li>
<li><p>Use the concatenated value as the second input to the <code class="docutils literal notranslate"><span class="pre">Reshape</span></code> operation.</p></li>
</ol>
<p>It is highly recommended to write shape-agnostic transformations to avoid model reshape-ability issues. For more information related to the reshaping of a model, refer to the <a class="reference internal" href="openvino_docs_OV_UG_ShapeInference.html#doxid-openvino-docs-o-v-u-g-shape-inference"><span class="std std-ref">Using Shape Inference</span></a> guide.</p>
<p>More information on how to develop front phase transformations and dedicated API description is provided in the <a class="reference external" href="#front-phase-transformations">Front Phase Transformations</a> section.</p>
</section>
<section id="partial-inference">
<span id="id6"></span><h3>Partial Inference<a class="headerlink" href="#partial-inference" title="Permalink to this headline">¶</a></h3>
<p>Model Optimizer performs a partial inference of a model during model conversion. This procedure includes output shapes calculation of all operations in a model and constant folding (value calculation for constant sub-graphs). The constant folding is needed for the shape inference because in some cases evaluation of constant sub-graph is needed to calculate output shapes. For example, the output shape for the <a class="reference internal" href="openvino_docs_ops_shape_Reshape_1.html#doxid-openvino-docs-ops-shape-reshape-1"><span class="std std-ref">Reshape</span></a> operation may be defined as a mathematical expression using the <a class="reference internal" href="openvino_docs_ops_shape_ShapeOf_3.html#doxid-openvino-docs-ops-shape-shape-of-3"><span class="std std-ref">ShapeOf</span></a> operation output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Model Optimizer does not fold sub-graphs starting from the <a class="reference internal" href="openvino_docs_ops_shape_ShapeOf_3.html#doxid-openvino-docs-ops-shape-shape-of-3"><span class="std std-ref">ShapeOf</span></a> operation by default because this leads to a model non-reshape-ability (the command-line parameter <code class="docutils literal notranslate"><span class="pre">--static_shape</span></code> can override this behavior). For more information related to reshaping of a model, refer to the <a class="reference internal" href="openvino_docs_OV_UG_ShapeInference.html#doxid-openvino-docs-o-v-u-g-shape-inference"><span class="std std-ref">Using Shape Inference</span></a> guide.</p>
</div>
<p>Model Optimizer calculates output shapes for all operations in a model to write them to Intermediate Representation files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a legacy requirement. Starting with IR version 10, OpenVINO Runtime needs to know shapes of the <a class="reference internal" href="openvino_docs_ops_infrastructure_Constant_1.html#doxid-openvino-docs-ops-infrastructure-constant-1"><span class="std std-ref">Const</span></a> and the <a class="reference internal" href="openvino_docs_ops_infrastructure_Parameter_1.html#doxid-openvino-docs-ops-infrastructure-parameter-1"><span class="std std-ref">Parameter</span></a> operations only. The OpenVINO Runtime calculates output shapes for all operations in a model, using shapes of <a class="reference internal" href="openvino_docs_ops_infrastructure_Parameter_1.html#doxid-openvino-docs-ops-infrastructure-parameter-1"><span class="std std-ref">Parameter</span></a> and <a class="reference internal" href="openvino_docs_ops_infrastructure_Constant_1.html#doxid-openvino-docs-ops-infrastructure-constant-1"><span class="std std-ref">Const</span></a> operations defined with respective operation attributes.</p>
</div>
<p>Model Optimizer inserts <strong>data</strong> nodes to the computation graph before starting the partial inference phase. The data node corresponds to the specific tensor produced with the operation. Each data node contains two attributes: <code class="docutils literal notranslate"><span class="pre">shape</span></code>, containing the shape of the tensor, and <code class="docutils literal notranslate"><span class="pre">value</span></code>, which may contain the actual value of the tensor. The value for a <code class="docutils literal notranslate"><span class="pre">value</span></code> attribute is equal to <code class="docutils literal notranslate"><span class="pre">None</span></code> if this tensor value cannot be calculated. This happens in two cases: when a tensor value depends on a values passed to the <a class="reference internal" href="openvino_docs_ops_infrastructure_Parameter_1.html#doxid-openvino-docs-ops-infrastructure-parameter-1"><span class="std std-ref">Parameter</span></a> operation of a model or Model Optimizer does not have value propagation implementation for the operation.</p>
<p>Before running partial inference, the graph can be depicted like in the following example:</p>
<img alt="Graph Before Partial Inference" src="../_images/MO_graph_before_partial_inference.png" />
<p>The difference in a graph structure with a graph during the front phase is not only in the data nodes, but also in the edge attributes. Note that an <code class="docutils literal notranslate"><span class="pre">out</span></code> attribute is specified for edges <strong>from operation</strong> nodes only, while an <code class="docutils literal notranslate"><span class="pre">in</span></code> attribute is specified for edges <strong>from data</strong> nodes only. This corresponds to the fact that a tensor (data node) is produced from a specific output port of an operation and is consumed with a specific input port of an operation. Also, a unique data node is created for each output port of an operation. The node may be used as an input node for several operation nodes. Similarly to the data node “data2_0”, which is consumed with the input “port 1” of the “Operation 3” and input “port 0” of the “Operation 5”.</p>
<p>Now, consider how Model Optimizer performs shape and value propagation. Model Optimizer performs graph nodes topological sort. An error message is thrown if a graph contains a cycle. Then, shape inference functions are called for each node in the graph, according to the topological order. Each node of the graph must have an attribute called <code class="docutils literal notranslate"><span class="pre">infer</span></code> with a shape inference function, which is a function with one parameter – an instance of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> class. The <code class="docutils literal notranslate"><span class="pre">infer</span></code> attribute is usually set in the operation extractor or when a node is added in some transformation using the Model Optimizer operation class inherited from the <code class="docutils literal notranslate"><span class="pre">mo.pos.Op</span></code> class. For more information on how to specify a shape inference function, refer to the <a class="reference external" href="#extension-operation">Model Optimizer Operation</a> and <a class="reference external" href="#operation-extractor">Operation Extractor</a> sections.</p>
<p>A shape inference function should calculate an operation (node) output shape(s) based on input shape(s) and operation (node) attribute(s) and update <code class="docutils literal notranslate"><span class="pre">shape</span></code> and optionally <code class="docutils literal notranslate"><span class="pre">value</span></code> attributes of the corresponding data node(s). A simplified example of the shape infer function for the <a class="reference internal" href="openvino_docs_ops_shape_Reshape_1.html#doxid-openvino-docs-ops-shape-reshape-1"><span class="std std-ref">Reshape</span></a> operation (the full version is available in the <code class="docutils literal notranslate"><span class="pre">mo/ops/reshape.py</span></code> file):</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="err">@</span><span class="n">staticmethod</span>
<span class="n">def</span> <span class="n">infer</span><span class="p">(</span><span class="nl">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span><span class="o">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;name&#39;</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">get_shape</span><span class="p">()</span>  <span class="err">#</span> <span class="n">get</span> <span class="n">the</span> <span class="n">input</span> <span class="n">tensor</span> <span class="n">shape</span>
    <span class="n">new_shape</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">get_value</span><span class="p">()</span>  <span class="err">#</span> <span class="n">get</span> <span class="n">the</span> <span class="n">value</span> <span class="n">defining</span> <span class="n">the</span> <span class="n">output</span> <span class="n">tensor</span> <span class="n">shape</span><span class="p">.</span> <span class="n">This</span> <span class="n">tensor</span> <span class="n">may</span>
                                                  <span class="cp"># have special values like 0 and -1</span>

    <span class="n">output_shape</span> <span class="o">=</span> <span class="p">...</span> <span class="err">#</span> <span class="n">calculate</span> <span class="n">output</span> <span class="n">shape</span> <span class="n">without</span> <span class="n">special</span> <span class="n">values</span> <span class="n">like</span> <span class="mi">0</span> <span class="n">and</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">get_value</span><span class="p">()</span> <span class="n">is</span> <span class="n">not</span> <span class="nl">None</span><span class="p">:</span>  <span class="err">#</span> <span class="k">if</span> <span class="n">the</span> <span class="n">input</span> <span class="n">value</span> <span class="n">is</span> <span class="n">defined</span> <span class="n">then</span> <span class="n">calculate</span> <span class="n">output</span> <span class="n">value</span><span class="p">;</span>
                                                      <span class="cp"># shape will be updated automatically with the value shape</span>
        <span class="n">node</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">get_value</span><span class="p">().</span><a class="reference internal" href="../api/groups/namespacengraph_1_1builder_1_1opset1.html#doxid-namespacengraph-1-1builder-1-1opset1-1ad5b09acfb63fe54b85b33d6e22ccdc72"><span class="std std-ref">reshape</span></a><span></span><span class="p">(</span><span class="n">output_shape</span><span class="p">))</span>
    <span class="k">else</span><span class="o">:</span>  <span class="err">#</span> <span class="n">in</span> <span class="n">the</span> <span class="n">opposite</span> <span class="k">case</span> <span class="n">calculate</span> <span class="n">the</span> <span class="n">output</span> <span class="n">shape</span> <span class="n">only</span>
        <span class="n">node</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">data</span><span class="p">.</span><span class="n">set_shape</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span></pre></div></div><p>Methods <code class="docutils literal notranslate"><span class="pre">in_port()</span></code> and <code class="docutils literal notranslate"><span class="pre">output_port()</span></code> of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> class are used to get and set data node attributes. For more information on how to use them, refer to the <a class="reference external" href="#graph-ports-and-conneсtions">Graph Traversal and Modification Using Ports and Connections</a> section.</p>
<div class="admonition note" id="middle-phase">
<p class="admonition-title">Note</p>
<p>A shape inference function should perform output shape calculation in the original model layout. For example, OpenVINO supports Convolution operations in NCHW layout only but TensorFlow supports NHWC layout as well. Model Optimizer shape inference function calculates output shapes for NHWC Convolutions in NHWC layout and only during the layout change phase the shape is converted to NCHW.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a legacy approach to read data node attribute, like <code class="docutils literal notranslate"><span class="pre">input_shape</span> <span class="pre">=</span> <span class="pre">op_node.in_node(0).shape</span></code> and modify data nodes attributes, like <code class="docutils literal notranslate"><span class="pre">op_node.out_node(0).shape</span> <span class="pre">=</span> <span class="pre">some_value</span></code>. This approach is still used in the Model Optimizer code but is not recommended. Instead, use the approach described in the <a class="reference external" href="#intro-ports">Ports</a>.</p>
</div>
</section>
<section id="id7">
<h3>Middle Phase<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The middle phase starts after partial inference. At this phase, a graph contains data nodes and output shapes of all operations in the graph have been calculated. Any transformation implemented at this stage must update the <code class="docutils literal notranslate"><span class="pre">shape</span></code> attribute for all newly added operations. It is highly recommended to use API described in the <a class="reference external" href="#graph-ports-and-conneсtions">Graph Traversal and Modification Using Ports and Connections</a> because modification of a graph using this API causes automatic re-inference of affected nodes as well as necessary data nodes creation.</p>
<p>More information on how to develop middle transformations and dedicated API description is provided in the <a class="reference external" href="#middle-phase-transformations">Middle Phase Transformations</a>.</p>
</section>
<section id="nhwc-to-nchw-layout-change">
<span id="layout-change"></span><h3>NHWC to NCHW Layout Change<a class="headerlink" href="#nhwc-to-nchw-layout-change" title="Permalink to this headline">¶</a></h3>
<p>There are several middle transformations responsible for changing model layout from NHWC to NCHW. These transformations are triggered by default for TensorFlow models as TensorFlow supports Convolution operations in the NHWC layout.</p>
<p>This layout change is disabled automatically if the model does not have operations that OpenVINO&amp;trade needs to execute in the NCHW layout, for example, Convolutions in NHWC layout.</p>
<p>It is still possible to force Model Optimizer to do a layout change, using <code class="docutils literal notranslate"><span class="pre">--disable_nhwc_to_nchw</span></code> command-line parameter, although it is not advised.</p>
<p>Layout change is a complex problem and will be addressed here very briefly. For more details on how it works, refer to the source code of the transformations mentioned in the below summary of the process:</p>
<ol class="arabic simple">
<li><p>Model Optimizer changes output shapes of most of operations producing 4D and 5D (four dimensional and five dimensional) tensors as if they were in NHWC layout to NCHW layout: <code class="docutils literal notranslate"><span class="pre">nchw_shape</span> <span class="pre">=</span> <span class="pre">np.array(nhwc_shape)[0,</span> <span class="pre">3,</span> <span class="pre">1,</span> <span class="pre">2]</span></code> for 4D and <code class="docutils literal notranslate"><span class="pre">nchw_shape</span> <span class="pre">=</span> <span class="pre">np.array(nhwc_shape)[0,</span> <span class="pre">4,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> for 5D. This permutation does not happen for some operations with specific conditions identified during a model conversion.</p></li>
<li><p>Model Optimizer inserts <a class="reference internal" href="openvino_docs_ops_movement_Gather_1.html#doxid-openvino-docs-ops-movement-gather-1"><span class="std std-ref">Gather</span></a> operations to the sub-graph relates to shapes calculation in order to perform shape calculation in a correct layout.</p></li>
<li><p>Model Optimizer inserts <a class="reference internal" href="openvino_docs_ops_movement_Transpose_1.html#doxid-openvino-docs-ops-movement-transpose-1"><span class="std std-ref">Transpose</span></a> operations for some operations with specific conditions, identified during a model conversion, to produce correct inference results.</p></li>
</ol>
<p>The list of main transformations responsible for a layout change are: <code class="docutils literal notranslate"><span class="pre">extensions/middle/ApplyPermutations.py</span></code>, <code class="docutils literal notranslate"><span class="pre">extensions/middle/InsertLayoutPropagationTransposes.py</span></code>, <code class="docutils literal notranslate"><span class="pre">extensions/middle/MarkSubgraphsWithCorrectLayout.py</span></code>, <code class="docutils literal notranslate"><span class="pre">extensions/middle/ApplyNHWCtoNCHWpermutation.py</span></code> and <code class="docutils literal notranslate"><span class="pre">extensions/middle/LayoutChangeForConstantShapePaths.py</span></code>.</p>
</section>
<section id="back-phase">
<span id="id8"></span><h3>Back Phase<a class="headerlink" href="#back-phase" title="Permalink to this headline">¶</a></h3>
<p>The back phase starts after the layout change to NCHW. This phase contains mostly the following transformations:</p>
<ol class="arabic simple">
<li><p>Transformations that should work with a graph in the NCHW layout and thus cannot be implemented in the middle phase.</p></li>
<li><p>Transformations that replace nodes corresponding to internal Model Optimizer operations with nodes corresponding to the <a class="reference internal" href="openvino_docs_ops_opset.html#doxid-openvino-docs-ops-opset"><span class="std std-ref">opset</span></a> operations.</p></li>
<li><p>Transformations that normalize operations inputs according to the specification.</p></li>
<li><p>Final optimization transformations.</p></li>
</ol>
<p>A graph structure during the back phase is the same as during the middle phase. There is no difference in writing middle and back transformations.</p>
<p>More information on how to develop back transformations and dedicated API description is provided in the <a class="reference external" href="#back-phase-transformations">Back Phase Transformations</a>.</p>
</section>
<section id="intermediate-representation-emitting">
<span id="ir-emitting"></span><h3>Intermediate Representation Emitting<a class="headerlink" href="#intermediate-representation-emitting" title="Permalink to this headline">¶</a></h3>
<p>The last phase of a model conversion is the Intermediate Representation emitting. Model Optimizer performs the following steps:</p>
<ol class="arabic simple">
<li><p>Iterates over all operation nodes in the graph and checks that all nodes have the <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute set. This attribute defines the operation type and is used in the OpenVINO to instantiate proper operation from the <a class="reference internal" href="openvino_docs_ops_opset.html#doxid-openvino-docs-ops-opset"><span class="std std-ref">opset</span></a> specified in the <code class="docutils literal notranslate"><span class="pre">version</span></code> attribute of the node. If a node does not have attribute <code class="docutils literal notranslate"><span class="pre">type</span></code> or its value is equal to <code class="docutils literal notranslate"><span class="pre">None</span></code>, Model Optimizer exits with an error.</p></li>
<li><p>Performs type inference of graph operations similar to the shape inference. Inferred data types are saved to a port attributes in the IR.</p></li>
<li><p>Performs topological sort of the graph and changes <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute of all operation nodes to be sequential integer values starting from 0.</p></li>
<li><p>Saves all Constants values to the <code class="docutils literal notranslate"><span class="pre">.bin</span></code> file. Constants with the same value are shared among different operations.</p></li>
<li><p>Generates an <code class="docutils literal notranslate"><span class="pre">.xml</span></code> file defining a graph structure. The information about operation inputs and outputs are prepared uniformly for all operations regardless of their type. A list of attributes to be saved to the <code class="docutils literal notranslate"><span class="pre">.xml</span></code> file is defined with the <code class="docutils literal notranslate"><span class="pre">backend_attrs()</span></code> or <code class="docutils literal notranslate"><span class="pre">supported_attrs()</span></code> of the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class used for a graph node instantiation. For more information on how the operation attributes are saved to XML, refer to the function <code class="docutils literal notranslate"><span class="pre">prepare_emit_ir()</span></code> in the <code class="docutils literal notranslate"><span class="pre">mo/pipeline/common.py</span></code> file and <a class="reference external" href="#extension-operation">Model Optimizer Operation</a> section.</p></li>
</ol>
</section>
</section>
<section id="graph-traversal-and-modification-using-ports-and-connections">
<span id="graph-ports-and-connetions"></span><h2>Graph Traversal and Modification Using Ports and Connections<a class="headerlink" href="#graph-traversal-and-modification-using-ports-and-connections" title="Permalink to this headline">¶</a></h2>
<p>There are three APIs for a graph traversal and transformation used in the Model Optimizer:</p>
<ol class="arabic simple">
<li><p>The API provided with the <code class="docutils literal notranslate"><span class="pre">networkx</span></code> Python library for the <code class="docutils literal notranslate"><span class="pre">networkx.MultiDiGraph</span></code> class, which is the base class for the <code class="docutils literal notranslate"><span class="pre">mo.graph.graph.Graph</span></code> object. For more details, refer to the <a class="reference external" href="#model-representation-in-memory">Model Representation in Memory</a> section. For example, the following methods belong to this API level: <code class="docutils literal notranslate"><span class="pre">graph.add_edges_from([list])</span></code>, <code class="docutils literal notranslate"><span class="pre">graph.add_node(x,</span> <span class="pre">attrs)</span></code>, <code class="docutils literal notranslate"><span class="pre">graph.out_edges(node_id)</span></code> etc where <code class="docutils literal notranslate"><span class="pre">graph</span></code> is a an instance of the <code class="docutils literal notranslate"><span class="pre">networkx.MultiDiGraph</span></code> class. <strong>This is the lowest-level API. Avoid using it in the Model Optimizer transformations</strong>.</p></li>
<li><p>The API built around the <code class="docutils literal notranslate"><span class="pre">mo.graph.graph.Node</span></code> class. The <code class="docutils literal notranslate"><span class="pre">Node</span></code> class is the primary class to work with graph nodes and their attributes. There are some <code class="docutils literal notranslate"><span class="pre">Node</span></code> class methods not recommended for use and some functions defined in the <code class="docutils literal notranslate"><span class="pre">mo.graph.graph</span></code> have been deprecated. Examples of such methods and functions are: <code class="docutils literal notranslate"><span class="pre">node.in_node(y)</span></code>, <code class="docutils literal notranslate"><span class="pre">node.out_node(x)</span></code>, <code class="docutils literal notranslate"><span class="pre">node.get_outputs()</span></code>, <code class="docutils literal notranslate"><span class="pre">node.insert_node_after(n1,</span> <span class="pre">y)</span></code>, <code class="docutils literal notranslate"><span class="pre">create_edge(n1,</span> <span class="pre">n2)</span></code> etc. For more details, refer to the <code class="docutils literal notranslate"><span class="pre">mo/graph/graph.py</span></code> file.</p></li>
<li><p>The high-level API called Model Optimizer Graph API, which uses <code class="docutils literal notranslate"><span class="pre">mo.graph.graph.Graph</span></code>, <code class="docutils literal notranslate"><span class="pre">mo.graph.port.Port</span></code> and <code class="docutils literal notranslate"><span class="pre">mo.graph.connection.Connection</span></code> classes. For example, the following methods belong to this API level: <code class="docutils literal notranslate"><span class="pre">node.in_port(x)</span></code>, <code class="docutils literal notranslate"><span class="pre">node.out_port(y)</span></code>, <code class="docutils literal notranslate"><span class="pre">port.get_connection()</span></code>, <code class="docutils literal notranslate"><span class="pre">connection.get_source()</span></code>, <code class="docutils literal notranslate"><span class="pre">connection.set_destination(dest_port)</span></code> etc. <strong>This is the recommended API for the Model Optimizer transformations and operations implementation</strong>.</p></li>
</ol>
<p>The main benefit of using the Model Optimizer Graph API is that it hides some internal implementation details (the fact that the graph contains data nodes), provides API to perform safe and predictable graph manipulations, and adds operation semantic to the graph. This is achieved with introduction of concepts of ports and connections. This article is dedicated to the Model Optimizer Graph API only and does not cover other two non-recommended APIs.</p>
<section id="ports">
<span id="intro-ports"></span><h3>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h3>
<p>An operation semantic describes how many inputs and outputs the operation has. For example, <a class="reference internal" href="openvino_docs_ops_infrastructure_Parameter_1.html#doxid-openvino-docs-ops-infrastructure-parameter-1"><span class="std std-ref">Parameter</span></a> and <a class="reference internal" href="openvino_docs_ops_infrastructure_Constant_1.html#doxid-openvino-docs-ops-infrastructure-constant-1"><span class="std std-ref">Const</span></a> operations have no inputs and have one output, <a class="reference internal" href="openvino_docs_ops_activation_ReLU_1.html#doxid-openvino-docs-ops-activation-re-l-u-1"><span class="std std-ref">ReLU</span></a> operation has one input and one output, <a class="reference internal" href="openvino_docs_ops_movement_Split_1.html#doxid-openvino-docs-ops-movement-split-1"><span class="std std-ref">Split</span></a> operation has 2 inputs and a variable number of outputs depending on the value of the attribute <code class="docutils literal notranslate"><span class="pre">num_splits</span></code>.</p>
<p>Each operation node in the graph (an instance of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> class) has 0 or more input and output ports (instances of the <code class="docutils literal notranslate"><span class="pre">mo.graph.port.Port</span></code> class). The <code class="docutils literal notranslate"><span class="pre">Port</span></code> object has several attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> - the instance of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> object the port belongs to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idx</span></code> - the port number. Input and output ports are numbered independently, starting from <code class="docutils literal notranslate"><span class="pre">0</span></code>. Thus, <a class="reference internal" href="openvino_docs_ops_activation_ReLU_1.html#doxid-openvino-docs-ops-activation-re-l-u-1"><span class="std std-ref">ReLU</span></a> operation has one input port (with index <code class="docutils literal notranslate"><span class="pre">0</span></code>) and one output port (with index <code class="docutils literal notranslate"><span class="pre">0</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> - the type of the port. Could be equal to either <code class="docutils literal notranslate"><span class="pre">&quot;in&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;out&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> - the object that should be used to get attributes of the corresponding data node. This object has methods <code class="docutils literal notranslate"><span class="pre">get_shape()</span></code> / <code class="docutils literal notranslate"><span class="pre">set_shape()</span></code> and <code class="docutils literal notranslate"><a class="reference internal" href="../api/groups/namespacengraph_1_1runtime_1_1reference_1_1detail.html#doxid-namespacengraph-1-1runtime-1-1reference-1-1detail-1ad9c8e24a4553eea531ddd4cbfcbc2610"><span class="std std-ref"><span class="pre">get_value()</span></span></a></code> / <code class="docutils literal notranslate"><span class="pre">set_value()</span></code> to get/set shape/value of the corresponding data node. For example, <code class="docutils literal notranslate"><span class="pre">in_port.data.get_shape()</span></code> returns an input shape of a tensor connected to input port <code class="docutils literal notranslate"><span class="pre">in_port</span></code> (in_port.type == ‘in <code class="docutils literal notranslate"><span class="pre">),</span></code> <a class="reference internal" href="../api/groups/namespacengraph_1_1runtime_1_1reference_1_1detail.html#doxid-namespacengraph-1-1runtime-1-1reference-1-1detail-1ad9c8e24a4553eea531ddd4cbfcbc2610"><span class="std std-ref">out_port.data.get_value()</span></a> <code class="docutils literal notranslate"><span class="pre">returns</span> <span class="pre">a</span> <span class="pre">value</span> <span class="pre">of</span> <span class="pre">a</span> <span class="pre">tensor</span> <span class="pre">produced</span> <span class="pre">from</span> <span class="pre">output</span> <span class="pre">port</span></code> out_port <code class="docutils literal notranslate"><span class="pre">(</span></code> out_port.type == ‘out’<a href="#id9"><span class="problematic" id="id10">`</span></a>).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions <code class="docutils literal notranslate"><span class="pre">get_shape()</span></code> and <code class="docutils literal notranslate"><a class="reference internal" href="../api/groups/namespacengraph_1_1runtime_1_1reference_1_1detail.html#doxid-namespacengraph-1-1runtime-1-1reference-1-1detail-1ad9c8e24a4553eea531ddd4cbfcbc2610"><span class="std std-ref"><span class="pre">get_value()</span></span></a></code> return <code class="docutils literal notranslate"><span class="pre">None</span></code> until the partial inference phase. For more information about model conversion phases, refer to the <a class="reference external" href="#model-conversion-pipeline">Model Conversion Pipeline</a> section. For information about partial inference phase, see the <a class="reference external" href="#partial-inference">Partial Inference</a> section.</p>
</div>
<p>There are several methods of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> class to get the instance of a corresponding port:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in_port(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">out_port(x)</span></code> to get the input/output port with number <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_ports()</span></code> and <code class="docutils literal notranslate"><span class="pre">out_ports()</span></code> to get a dictionary, where key is a port number and the value is the corresponding input/output port.</p></li>
</ul>
<p>Attributes <code class="docutils literal notranslate"><span class="pre">in_ports_count</span></code> and <code class="docutils literal notranslate"><span class="pre">out_ports_count</span></code> of the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class instance define default number of input and output ports to be created for the <code class="docutils literal notranslate"><span class="pre">Node</span></code>. However, additional input/output ports can be added using methods <code class="docutils literal notranslate"><span class="pre">add_input_port()</span></code> and <code class="docutils literal notranslate"><span class="pre">add_output_port()</span></code>. Port also can be removed, using the <code class="docutils literal notranslate"><span class="pre">delete_input_port()</span></code> and <code class="docutils literal notranslate"><span class="pre">delete_output_port()</span></code> methods.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Port</span></code> class is just an abstraction that works with edges incoming/outgoing to/from a specific <code class="docutils literal notranslate"><span class="pre">Node</span></code> instance. For example, output port with <code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">=</span> <span class="pre">1</span></code> corresponds to the outgoing edge of a node with an attribute <code class="docutils literal notranslate"><span class="pre">out</span> <span class="pre">=</span> <span class="pre">1</span></code>, the input port with <code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">=</span> <span class="pre">2</span></code> corresponds to the incoming edge of a node with an attribute <code class="docutils literal notranslate"><span class="pre">in</span> <span class="pre">=</span> <span class="pre">2</span></code>.</p>
<p>Consider the example of a graph part with 4 operation nodes “Op1”, “Op2”, “Op3”, and “Op4” and a number of data nodes depicted with light green boxes.</p>
<img alt="Ports example 1" src="../_images/MO_ports_example_1.png" />
<p>Operation nodes have input ports (yellow squares) and output ports (light purple squares). Input port may not be connected. For example, the input “port 2” of node “Op1” does not have incoming edge, while output port always has an associated data node (after the partial inference when the data nodes are added to the graph), which may have no consumers.</p>
<p>Ports can be used to traverse a graph. The method <code class="docutils literal notranslate"><span class="pre">get_source()</span></code> of an input port returns an output port producing the tensor consumed by the input port. It is important that the method works the same during front, middle and back phases of a model conversion even though the graph structure changes (there are no data nodes in the graph during the front phase).</p>
<p>Let’s assume that there are 4 instances of <code class="docutils literal notranslate"><span class="pre">Node</span></code> object <code class="docutils literal notranslate"><span class="pre">op1,</span> <span class="pre">op2,</span> <span class="pre">op3</span></code>, and <code class="docutils literal notranslate"><span class="pre">op4</span></code> * corresponding to nodes “Op1”, “Op2”, “Op3”, and “Op4”, respectively. The result of <code class="docutils literal notranslate"><span class="pre">op2.in_port(0).get_source()</span></code> and <code class="docutils literal notranslate"><span class="pre">op4.in_port(1).get_source()</span></code> is the same object <code class="docutils literal notranslate"><span class="pre">op1.out_port(1)</span></code> of type <code class="docutils literal notranslate"><span class="pre">Port</span></code>.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">get_destination()</span></code> of an output port returns the input port of the node consuming this tensor. If there are multiple consumers of this tensor, the error is raised. The method <code class="docutils literal notranslate"><span class="pre">get_destinations()</span></code> of an output port returns a list of input ports consuming the tensor.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">disconnect()</span></code> removes a node incoming edge corresponding to the specific input port. The method removes several edges if it is applied during the front phase for a node output port connected with multiple nodes.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">port.connect(another_port)</span></code> connects output port <code class="docutils literal notranslate"><span class="pre">port</span></code> and input port <code class="docutils literal notranslate"><span class="pre">another_port</span></code>. The method handles situations when the graph contains data nodes (middle and back phases) and does not create an edge between two nodes but also automatically creates data node or reuses existing data node. If the method is used during the front phase and data nodes do not exist, the method creates edge and properly sets <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code> edge attributes.</p>
<p>For example, applying the following two methods to the graph above will result in the graph depicted below:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">op4</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">disconnect</span><span class="p">()</span>
<span class="n">op3</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">connect</span><span class="p">(</span><span class="n">op4</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span></pre></div></div><img alt="Ports example 2" src="../_images/MO_ports_example_2.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a full list of available methods, refer to the <code class="docutils literal notranslate"><span class="pre">Node</span></code> class implementation in the <code class="docutils literal notranslate"><span class="pre">mo/graph/graph.py</span></code> and <code class="docutils literal notranslate"><span class="pre">Port</span></code> class implementation in the</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mo/graph/port.py</span></code> files.</p>
</section>
<section id="connections">
<span id="intro-connetions"></span><h3>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h3>
<p>Connection is a concept introduced to easily and reliably perform graph modifications. Connection corresponds to a link between a source output port with one or more destination input ports or a link between a destination input port and source output port producing data. So each port is connected with one or more ports with help of a connection. Model Optimizer uses the <code class="docutils literal notranslate"><span class="pre">mo.graph.connection.Connection</span></code> class to represent a connection.</p>
<p>There is only one <code class="docutils literal notranslate"><span class="pre">get_connection()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Port</span></code> class to get the instance of the corresponding <code class="docutils literal notranslate"><span class="pre">Connection</span></code> object. If the port is not connected, the returned value is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">op3.out_port(0).get_connection()</span></code> method returns a <code class="docutils literal notranslate"><span class="pre">Connection</span></code> object encapsulating edges from node “Op3” to data node “data_3_0” and two edges from data node “data_3_0” to two ports of the node “Op4”.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Connection</span></code> class provides methods to get source and destination(s) ports the connection corresponds to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">connection.get_source()</span></code> - returns an output <code class="docutils literal notranslate"><span class="pre">Port</span></code> object producing the tensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connection.get_destinations()</span></code> * - returns a list of input <code class="docutils literal notranslate"><span class="pre">Port</span></code> consuming the data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connection.get_destination()</span></code> * - returns a single input <code class="docutils literal notranslate"><span class="pre">Port</span></code> consuming the data. If there are multiple consumers, the exception is raised.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Connection</span></code> class provides methods to modify a graph by changing a source or destination(s) of a connection. For example, the function call <code class="docutils literal notranslate"><span class="pre">op3.out_port(0).get_connection().set_source(op1.out_port(0))</span></code> changes source port of edges consuming data from port <code class="docutils literal notranslate"><span class="pre">op3.out_port(0)</span></code> to <code class="docutils literal notranslate"><span class="pre">op1.out_port(0)</span></code>. The transformed graph from the sample above is depicted below:</p>
<img alt="Connection example 1" src="../_images/MO_connection_example_1.png" />
<p>Another example is the <code class="docutils literal notranslate"><span class="pre">connection.set_destination(dest_port)</span></code> method. It disconnects <code class="docutils literal notranslate"><span class="pre">dest_port</span></code> and all input ports to which the connection is currently connected and connects the connection source port to <code class="docutils literal notranslate"><span class="pre">dest_port</span></code>.</p>
<p>Note that connection works seamlessly during front, middle, and back phases and hides the fact that the graph structure is different.</p>
<div class="admonition note" id="extensions">
<p class="admonition-title">Note</p>
<p>For a full list of available methods, refer to the <code class="docutils literal notranslate"><span class="pre">Connection</span></code> class implementation in the <code class="docutils literal notranslate"><span class="pre">mo/graph/connection.py</span></code> file.</p>
</div>
</section>
</section>
<section id="model-optimizer-extensions">
<h2>Model Optimizer Extensions<a class="headerlink" href="#model-optimizer-extensions" title="Permalink to this headline">¶</a></h2>
<p>Model Optimizer extensions enable you to inject some logic to the model conversion pipeline without changing the Model Optimizer core code. There are three types of the Model Optimizer extensions:</p>
<ol class="arabic simple">
<li><p>Model Optimizer operation.</p></li>
<li><p>A framework operation extractor.</p></li>
<li><p>A model transformation, which can be executed during front, middle or back phase of the model conversion.</p></li>
</ol>
<p>An extension is just a plain text file with a Python code. The file should contain a class (or classes) inherited from one of extension base classes. Extension files should be saved to a directory with the following structure:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/&lt;</span><span class="n">MY_EXT</span><span class="o">&gt;/</span>
           <span class="n">ops</span><span class="o">/</span>                  <span class="o">-</span> <span class="n">custom</span> <span class="n">operations</span>
           <span class="n">front</span><span class="o">/</span>                <span class="o">-</span> <span class="n">framework</span> <span class="n">independent</span> <span class="n">front</span> <span class="n">transformations</span>
                 <span class="o">&lt;</span><span class="n">FRAMEWORK_1</span><span class="o">&gt;/</span>  <span class="o">-</span> <span class="n">front</span> <span class="n">transformations</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">FRAMEWORK_1</span><span class="o">&gt;</span> <span class="n">models</span> <span class="n">only</span> <span class="n">and</span> <span class="n">extractors</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">FRAMEWORK_1</span><span class="o">&gt;</span> <span class="n">operations</span>
                 <span class="o">&lt;</span><span class="n">FRAMEWORK_2</span><span class="o">&gt;/</span>  <span class="o">-</span> <span class="n">front</span> <span class="n">transformations</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">FRAMEWORK_2</span><span class="o">&gt;</span> <span class="n">models</span> <span class="n">only</span> <span class="n">and</span> <span class="n">extractors</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">FRAMEWORK_2</span><span class="o">&gt;</span> <span class="n">operations</span>
                 <span class="p">...</span>
           <span class="n">middle</span><span class="o">/</span>               <span class="o">-</span> <span class="n">middle</span> <span class="n">transformations</span>
           <span class="n">back</span><span class="o">/</span>                 <span class="o">-</span> <span class="n">back</span> <span class="n">transformations</span></pre></div></div><p>Model Optimizer uses the same layout internally to keep built-in extensions. The only exception is that the <code class="docutils literal notranslate"><span class="pre">mo/ops/</span></code> directory is also used as a source of the Model Optimizer operations due to historical reasons.</p>
<div class="admonition note" id="extension-operation">
<p class="admonition-title">Note</p>
<p>The name of a root directory with extensions should not be equal to “extensions” because it will result in a name conflict with the built-in Model Optimizer extensions.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Model Optimizer itself is built by using these extensions, so there is a huge number of examples of their usage in the Model Optimizer code.</p>
</div>
<section id="model-optimizer-operation">
<h3>Model Optimizer Operation<a class="headerlink" href="#model-optimizer-operation" title="Permalink to this headline">¶</a></h3>
<p>Model Optimizer defines a <code class="docutils literal notranslate"><span class="pre">mo.ops.Op</span></code> class (<code class="docutils literal notranslate"><span class="pre">Op</span></code> will be used later in the document to be short), which is a base class for an operation used in the Model Optimizer. The instance of the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class serves several purposes:</p>
<ol class="arabic simple">
<li><p>Stores the operation attributes.</p></li>
<li><p>Stores the operation shape/value and type inference functions.</p></li>
<li><p>Defines operation attributes to be saved to the corresponding IR section.</p></li>
<li><p>Contains convenient methods to create a graph node from an <code class="docutils literal notranslate"><span class="pre">Op</span></code> object instance and connect it with the existing graph.</p></li>
<li><p>Used in the extractors to store parsed attributes and operation specific attributes in the dedicated graph node.</p></li>
</ol>
<p>It is important to mention that there is no connection between the instance of the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class and the <code class="docutils literal notranslate"><span class="pre">Node</span></code> object created from it. The <code class="docutils literal notranslate"><span class="pre">Op</span></code> class is just a container for attributes describing the operation. Model Optimizer uses the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class during a model conversion to create a node of the graph with attributes copied from the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class instance. Graph manipulations are performed with graph <code class="docutils literal notranslate"><span class="pre">Node</span></code> s and their attributes and does not involve <code class="docutils literal notranslate"><span class="pre">Op</span></code> s.</p>
<p>There are a number of common attributes used in the operations. Below is the list of these attributes with description.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> — unique identifier of a node in a graph. Generated automatically, equal to the number of nodes in the graph plus 1 if not specified. <strong>Mandatory</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> — name of the operation. Generated automatically, equal to the <code class="docutils literal notranslate"><span class="pre">id</span></code> if not specified. <strong>Mandatory</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> — type of the operation according to the <a class="reference internal" href="openvino_docs_ops_opset.html#doxid-openvino-docs-ops-opset"><span class="std std-ref">opset specification</span></a>. For the internal Model Optimizer operations, this attribute should be set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. The model conversion fails if an operation with <code class="docutils literal notranslate"><span class="pre">type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">None</span></code> comes to the IR emitting phase. <strong>Mandatory</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code> — the operation set (opset) name the operation belongs to. If not specified, Model Optimizer sets it equal to <code class="docutils literal notranslate"><span class="pre">experimental</span></code>. For more information about operation sets, refer to <a class="reference internal" href="openvino_docs_OV_UG_Model_Representation.html#doxid-openvino-docs-o-v-u-g-model-representation"><span class="std std-ref">OpenVINO Model Representation</span></a> section. <strong>Mandatory</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code> — Model Optimizer type of the operation. In many cases, the value of <code class="docutils literal notranslate"><span class="pre">type</span></code> is equal to the value of <code class="docutils literal notranslate"><span class="pre">op</span></code>. However, when Model Optimizer cannot instantiate the opset operation during model loading, it creates an instance of an internal operation. Thus, the attribute <code class="docutils literal notranslate"><span class="pre">op</span></code> is used as a type of this internal operation. Later in the pipeline, the node created from an internal operation will be replaced during front, middle or back phase with node(s) created from the opset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infer</span></code> — the attribute defines a function calculating output tensor(s) shape and optional value(s). The attribute may be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> for the internal Model Optimizer operations used during the front phase only. For more information about the shape inference function, refer to the <a class="reference external" href="#partial-inference">Partial Inference</a> section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type_infer</span></code> — the attribute defines a function calculating output tensor(s) data type. If the attribute is not defined, the default function is used. The function checks if the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> node attribute is set and then propagates this type to the output tensor from the “port 0”. Otherwise, it propagates the data type of the tensor coming into the input “port 0” to the output tensor from the “port 0”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_ports_count</span></code> — default number of input ports to be created for the operation. Additional ports can be created or redundant ports can be removed using dedicated <code class="docutils literal notranslate"><span class="pre">Node</span></code> class API methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_ports_count</span></code> — default number of output ports to be created for the operation. Additional ports can be created or redundant ports can be removed using dedicated <code class="docutils literal notranslate"><span class="pre">Node</span></code> class API methods.</p></li>
</ul>
<p>Below is an example of the Model Optimizer class for the <a class="reference internal" href="openvino_docs_ops_activation_SoftMax_1.html#doxid-openvino-docs-ops-activation-soft-max-1"><span class="std std-ref">SoftMax</span></a> operation from the <code class="docutils literal notranslate"><span class="pre">mo/ops/softmax.py</span></code> file with the comments in code.</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nf">Softmax</span><span class="p">(</span><span class="n">Op</span><span class="p">)</span><span class="o">:</span>
    <span class="cp"># The class attribute defines a name of the operation so the operation class can be obtained using the</span>
    <span class="cp"># &quot;Op.get_op_class_by_name()&quot; static method</span>
    <span class="n">op</span> <span class="o">=</span> <span class="sc">&#39;SoftMax&#39;</span>

    <span class="cp"># The operation works as an extractor by default. This is a legacy behavior, currently not recommended for use,</span>
    <span class="cp"># thus &quot;enabled&quot; class attribute is set to False. The recommended approach is to use dedicated extractor extension.</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">False</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nl">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="nl">attrs</span><span class="p">:</span> <span class="n">dict</span><span class="p">)</span><span class="o">:</span>
        <span class="n">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">constructor</span> <span class="n">of</span> <span class="n">the</span> <span class="n">base</span> <span class="k">class</span> <span class="n">Op</span> <span class="n">is</span> <span class="n">called</span> <span class="n">with</span> <span class="n">additional</span> <span class="k">default</span> <span class="n">attributes</span><span class="p">.</span>
            <span class="sc">&#39;type&#39;</span><span class="o">:</span> <span class="n">__class__</span><span class="p">.</span><span class="n">op</span><span class="p">,</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">operation</span> <span class="n">is</span> <span class="n">from</span> <span class="n">the</span> <span class="n">opset</span> <span class="n">so</span> <span class="n">the</span> <span class="n">type</span> <span class="n">is</span> <span class="n">set</span> <span class="n">to</span> <span class="sc">&#39;SoftMax&#39;</span><span class="p">.</span>
            <span class="sc">&#39;op&#39;</span><span class="o">:</span> <span class="n">__class__</span><span class="p">.</span><span class="n">op</span><span class="p">,</span>  <span class="err">#</span> <span class="n">Internal</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">operation</span> <span class="n">has</span> <span class="n">the</span> <span class="n">same</span> <span class="n">type</span><span class="p">.</span>
            <span class="sc">&#39;version&#39;</span><span class="o">:</span> <span class="sc">&#39;opset1&#39;</span><span class="p">,</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">operation</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">opset1</span><span class="p">.</span>
            <span class="sc">&#39;infer&#39;</span><span class="o">:</span> <span class="n">Softmax</span><span class="p">.</span><span class="n">infer</span><span class="p">,</span>  <span class="err">#</span> <span class="n">Shape</span> <span class="n">inference</span> <span class="n">function</span> <span class="n">is</span> <span class="n">defined</span> <span class="n">below</span><span class="p">.</span>
            <span class="sc">&#39;axis&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="err">#</span> <span class="n">Default</span> <span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="s">&quot;axis&quot;</span> <span class="n">attribute</span> <span class="n">of</span> <span class="n">the</span> <span class="n">operation</span> <span class="n">SoftMax</span><span class="p">.</span>
            <span class="sc">&#39;in_ports_count&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">operation</span> <span class="n">has</span> <span class="n">one</span> <span class="n">input</span><span class="p">.</span>
            <span class="sc">&#39;out_ports_count&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">operation</span> <span class="n">produces</span> <span class="n">one</span> <span class="n">output</span><span class="p">.</span>
        <span class="p">},</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="cp"># The method returns operation specific attributes list. This method is important when implementing</span>
    <span class="cp"># extractor inherited from CaffePythonFrontExtractorOp class to extract attribute for Caffe Python operation.</span>
    <span class="cp"># However, it is currently used interchangeably with the &quot;backend_attrs()&quot; method. If the &quot;backend_attrs()&quot; is not used,</span>
    <span class="cp"># then the &quot;supported_attrs()&quot; is used instead. In this particular case, the operation has just one attribute &quot;axis&quot;.</span>
    <span class="n">def</span> <span class="n">supported_attrs</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="sc">&#39;axis&#39;</span><span class="p">]</span>

    <span class="err">@</span><span class="n">staticmethod</span>
    <span class="n">def</span> <span class="n">infer</span><span class="p">(</span><span class="nl">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span><span class="o">:</span>
        <span class="s">&quot;some code calculating output shape and values&quot;</span></pre></div></div><p>There is a dedicated method called <code class="docutils literal notranslate"><span class="pre">backend_attrs()</span></code> defining a list of attributes to be saved to the IR. Consider an example from the <code class="docutils literal notranslate"><span class="pre">mo/ops/pooling.py</span></code> file:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">def</span> <span class="n">backend_attrs</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
     <span class="k">return</span> <span class="p">[</span>
         <span class="p">(</span><span class="sc">&#39;strides&#39;</span><span class="p">,</span> <span class="n">lambda</span> <span class="nl">node</span><span class="p">:</span> <span class="sc">&#39;,&#39;</span><span class="p">.</span><a class="reference internal" href="../api/groups/namespaceov_1_1util.html#doxid-namespaceov-1-1util-1a860e0918a7b731ba9e886baf48434318"><span class="std std-ref">join</span></a><span></span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="sc">&#39;stride&#39;</span><span class="p">][</span><span class="n">node</span><span class="p">.</span><span class="n">spatial_dims</span><span class="p">]))),</span>
         <span class="p">(</span><span class="sc">&#39;kernel&#39;</span><span class="p">,</span> <span class="n">lambda</span> <span class="nl">node</span><span class="p">:</span> <span class="sc">&#39;,&#39;</span><span class="p">.</span><a class="reference internal" href="../api/groups/namespaceov_1_1util.html#doxid-namespaceov-1-1util-1a860e0918a7b731ba9e886baf48434318"><span class="std std-ref">join</span></a><span></span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="sc">&#39;window&#39;</span><span class="p">][</span><span class="n">node</span><span class="p">.</span><span class="n">spatial_dims</span><span class="p">]))),</span>

         <span class="p">(</span><span class="sc">&#39;pads_begin&#39;</span><span class="p">,</span> <span class="n">lambda</span> <span class="nl">node</span><span class="p">:</span> <span class="sc">&#39;,&#39;</span><span class="p">.</span><a class="reference internal" href="../api/groups/namespaceov_1_1util.html#doxid-namespaceov-1-1util-1a860e0918a7b731ba9e886baf48434318"><span class="std std-ref">join</span></a><span></span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">get_backend_pad</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">pad</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">spatial_dims</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))),</span>
         <span class="p">(</span><span class="sc">&#39;pads_end&#39;</span><span class="p">,</span> <span class="n">lambda</span> <span class="nl">node</span><span class="p">:</span> <span class="sc">&#39;,&#39;</span><span class="p">.</span><a class="reference internal" href="../api/groups/namespaceov_1_1util.html#doxid-namespaceov-1-1util-1a860e0918a7b731ba9e886baf48434318"><span class="std std-ref">join</span></a><span></span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">get_backend_pad</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">pad</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">spatial_dims</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))),</span>

         <span class="p">(</span><span class="sc">&#39;pool-method&#39;</span><span class="p">,</span> <span class="sc">&#39;pool_method&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="sc">&#39;exclude-pad&#39;</span><span class="p">,</span> <span class="sc">&#39;exclude_pad&#39;</span><span class="p">),</span>

         <span class="sc">&#39;rounding_type&#39;</span><span class="p">,</span>
         <span class="sc">&#39;auto_pad&#39;</span><span class="p">,</span>
     <span class="p">]</span></pre></div></div><p>The <code class="docutils literal notranslate"><span class="pre">backend_attrs()</span></code> function returns a list of records. A record can be of one of the following formats:</p>
<ol class="arabic simple">
<li><p>A string defining the attribute to be saved to the IR. If the value of the attribute is <code class="docutils literal notranslate"><span class="pre">None</span></code>, the attribute is not saved. Examples of this case are <code class="docutils literal notranslate"><span class="pre">rounding_type</span></code> and <code class="docutils literal notranslate"><span class="pre">auto_pad</span></code>.</p></li>
<li><p>A tuple, where the first element is a string defining the name of the attribute as it will appear in the IR and the second element is a function to produce the value for this attribute. The function gets an instance of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> as the only parameter and returns a string with the value to be saved to the IR. Examples of this case are <code class="docutils literal notranslate"><span class="pre">strides</span></code>, <code class="docutils literal notranslate"><span class="pre">kernel</span></code>, <code class="docutils literal notranslate"><span class="pre">pads_begin</span></code> and <code class="docutils literal notranslate"><span class="pre">pads_end</span></code>.</p></li>
<li><p>A tuple, where the first element is a string defining the name of the attribute as it will appear in the IR and the second element is the name of the <code class="docutils literal notranslate"><span class="pre">Node</span></code> attribute to get the value from. Examples of this case are <code class="docutils literal notranslate"><span class="pre">pool-method</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude-pad</span></code>.</p></li>
</ol>
</section>
<section id="operation-extractor">
<span id="extension-extractor"></span><h3>Operation Extractor<a class="headerlink" href="#operation-extractor" title="Permalink to this headline">¶</a></h3>
<p>Model Optimizer runs specific extractor for each operation in the model during the model loading. For more information about this process, refer to the <a class="reference external" href="#operations-attributes-extracting">operations-attributes-extracting</a> section.</p>
<p>There are several types of Model Optimizer extractor extensions:</p>
<ol class="arabic simple">
<li><p>The generic one, which is described in this section.</p></li>
<li><p>The special extractor for Caffe models with Python layers. This kind of extractor is described in the <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Extending_Model_Optimizer_With_Caffe_Python_Layers.html#doxid-openvino-docs-m-o-d-g-prepare-model-customize-model-optimizer-extending-model-optimizer-with-caffe-python-layers"><span class="std std-ref">Extending Model Optimizer with Caffe Python Layers</span></a> guide.</p></li>
</ol>
<p>This section is focused on the option #1, which provides a generic mechanism for the operation extractor applicable for all frameworks. Model Optimizer provides the <code class="docutils literal notranslate"><span class="pre">mo.front.extractor.FrontExtractorOp</span></code> class as a base class to implement the extractor. It has the <code class="docutils literal notranslate"><span class="pre">extract</span></code> class method, which gets the only parameter <code class="docutils literal notranslate"><span class="pre">Node</span></code>, which corresponds to the graph node to extract data from. The operation description in the original framework format is stored in the attribute <code class="docutils literal notranslate"><span class="pre">pb</span></code> of the node. The extractor goal is to parse this attribute and save necessary attributes to the corresponding node of the graph. Consider the extractor for the <code class="docutils literal notranslate"><span class="pre">Const</span></code> TensorFlow operation (refer to the <code class="docutils literal notranslate"><span class="pre">extensions/front/tf/const_ext.py</span></code> file):</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">extractor</span> <span class="n">import</span> <span class="n">FrontExtractorOp</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">tf</span><span class="p">.</span><span class="n">extractors</span><span class="p">.</span><span class="n">utils</span> <span class="n">import</span> <span class="n">tf_dtype_extractor</span><span class="p">,</span> <span class="n">tf_tensor_shape</span><span class="p">,</span> <span class="n">tf_tensor_content</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="k">const</span> <span class="n">import</span> <span class="n">Const</span>


<span class="k">class</span> <span class="n">ConstExtractor</span><span class="p">(</span><span class="n">FrontExtractorOp</span><span class="p">)</span><span class="o">:</span>
    <span class="cp"># The &quot;op&quot; class attribute defines a type of the operation in the framework (in this case it is a TensorFlow),</span>
    <span class="cp"># for which the extractor should be triggered.</span>
    <span class="n">op</span> <span class="o">=</span> <span class="sc">&#39;Const&#39;</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">True</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">flag</span> <span class="n">that</span> <span class="n">indicates</span> <span class="n">that</span> <span class="k">this</span> <span class="n">extractor</span> <span class="n">is</span> <span class="n">enabled</span><span class="p">.</span>

    <span class="err">@</span><span class="n">classmethod</span>
    <span class="n">def</span> <span class="n">extract</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">entry</span> <span class="n">point</span> <span class="n">of</span> <span class="n">the</span> <span class="n">extractor</span><span class="p">.</span>
        <span class="cp"># The `node.pb` attribute stores the TensorFlow representation of the operation, which is a Protobuf message of the</span>
        <span class="cp"># specific format. In particular, the message contains the attribute called &quot;value&quot; containing the description of</span>
        <span class="cp"># the constant. The string &quot;pb.attr[&quot;value&quot;].tensor&quot; is just a Python binding for Protobuf message parsing.</span>
        <span class="n">pb_tensor</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">pb</span><span class="p">.</span><span class="n">attr</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">].</span><span class="n">tensor</span>
        <span class="cp"># Get the shape of the tensor from the protobuf message, using the helper function &quot;tf_tensor_shape&quot;.</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">tf_tensor_shape</span><span class="p">(</span><span class="n">pb_tensor</span><span class="p">.</span><span class="n">tensor_shape</span><span class="p">)</span>
        <span class="cp"># Create a dictionary with necessary attributes.</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sc">&#39;shape&#39;</span><span class="o">:</span> <span class="n">shape</span><span class="p">,</span>
            <span class="cp"># Get the tensor value, using &quot;tf_tensor_content&quot; helper function.</span>
            <span class="sc">&#39;value&#39;</span><span class="o">:</span> <span class="n">tf_tensor_content</span><span class="p">(</span><span class="n">pb_tensor</span><span class="p">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">pb_tensor</span><span class="p">),</span>
            <span class="cp"># Get the tensor data type, using &quot;tf_dtype_extractor&quot; helper function.</span>
            <span class="sc">&#39;data_type&#39;</span><span class="o">:</span> <span class="n">tf_dtype_extractor</span><span class="p">(</span><span class="n">pb_tensor</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="cp"># Update the node attributes, using default attributes from the &quot;Const&quot; operation and attributes saved to the</span>
        <span class="cp"># &quot;attrs&quot; dictionary.</span>
        <span class="n">Const</span><span class="p">.</span><span class="n">update_node_stat</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">enabled</span></pre></div></div><p>Consider another example with an extractor of the <code class="docutils literal notranslate"><span class="pre">Constant</span></code> ONNX operation (refer to the <code class="docutils literal notranslate"><span class="pre">extensions/front/onnx/const_ext.py</span></code> file):</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">from</span> <span class="n">onnx</span> <span class="n">import</span> <span class="n">numpy_helper</span>
<span class="n">from</span> <span class="n">onnx</span><span class="p">.</span><span class="n">numpy_helper</span> <span class="n">import</span> <span class="n">to_array</span>

<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">extractor</span> <span class="n">import</span> <span class="n">FrontExtractorOp</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">onnx</span><span class="p">.</span><span class="n">extractors</span><span class="p">.</span><span class="n">utils</span> <span class="n">import</span> <span class="n">onnx_attr</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="k">const</span> <span class="n">import</span> <span class="n">Const</span>


<span class="k">class</span> <span class="n">ConstantExtractor</span><span class="p">(</span><span class="n">FrontExtractorOp</span><span class="p">)</span><span class="o">:</span>
    <span class="n">op</span> <span class="o">=</span> <span class="sc">&#39;Constant&#39;</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">True</span>

    <span class="err">@</span><span class="n">classmethod</span>
    <span class="n">def</span> <span class="n">extract</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span><span class="o">:</span>
        <span class="cp"># Use &quot;onnx_attr&quot; helper method, which parses the Protobuf representation of the operation saved in the &quot;node&quot;.</span>
        <span class="cp"># Gets the value of the attribute with name &quot;value&quot; as &quot;TensorProto&quot; type (specified with a keyword &quot;t&quot;).</span>
        <span class="n">pb_value</span> <span class="o">=</span> <span class="n">onnx_attr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="sc">&#39;value&#39;</span><span class="p">,</span> <span class="sc">&#39;t&#39;</span><span class="p">)</span>
        <span class="cp"># Use &quot;numpy_helper.to_array()&quot; ONNX helper method to convert &quot;TensorProto&quot; object to a numpy array.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">numpy_helper</span><span class="p">.</span><span class="n">to_array</span><span class="p">(</span><span class="n">pb_value</span><span class="p">)</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sc">&#39;data_type&#39;</span><span class="o">:</span> <span class="n">value</span><span class="p">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="sc">&#39;value&#39;</span><span class="o">:</span> <span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="cp"># Update the node attributes, using default attributes from the &quot;Const&quot; operation and attributes saved to the</span>
        <span class="cp"># &quot;attrs&quot; dictionary.</span>
        <span class="n">Const</span><span class="p">.</span><span class="n">update_node_stat</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">enabled</span></pre></div></div><p>The extractors for operations from different frameworks work similarly. The only difference is in the helper methods used to parse operation attributes encoded with a framework-specific representation.</p>
<p>A common practice is to use <code class="docutils literal notranslate"><span class="pre">update_node_stat()</span></code> method of the dedicated <code class="docutils literal notranslate"><span class="pre">Op</span></code> class to update the node attributes. This method does the following:</p>
<ol class="arabic simple">
<li><p>Sets values for common attributes like <code class="docutils literal notranslate"><span class="pre">op</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">infer</span></code>, <code class="docutils literal notranslate"><span class="pre">in_ports_count</span></code>, <code class="docutils literal notranslate"><span class="pre">out_ports_count</span></code>, <code class="docutils literal notranslate"><span class="pre">version</span></code> to values specific to the dedicated operation (<code class="docutils literal notranslate"><span class="pre">Const</span></code> operation in this case).</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">supported_attrs()</span></code> and <code class="docutils literal notranslate"><span class="pre">backend_attrs()</span></code> methods, defined in the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class to update specific node attribute <code class="docutils literal notranslate"><span class="pre">IE</span></code>. The IR emitter uses the value stored in the <code class="docutils literal notranslate"><span class="pre">IE</span></code> attribute to pre-process attribute values and save them to IR.</p></li>
<li><p>Optionally sets additional attributes provided to the <code class="docutils literal notranslate"><span class="pre">update_node_stat()</span></code> function as a second parameter. Usually these attributes are parsed from the particular instance of the operation.</p></li>
</ol>
<div class="admonition note" id="graph-transformations">
<p class="admonition-title">Note</p>
<p>Model Optimizer uses numpy arrays to store values and numpy arrays of <code class="docutils literal notranslate"><span class="pre">np.int64</span></code> type to store shapes in the graph.</p>
</div>
</section>
<section id="graph-transformation-extensions">
<h3>Graph Transformation Extensions<a class="headerlink" href="#graph-transformation-extensions" title="Permalink to this headline">¶</a></h3>
<p>Model Optimizer provides various base classes to implement <a class="reference external" href="#front-phase-transformations">Front Phase Transformations</a>, <a class="reference external" href="#middle-phase-transformations">Middle Phase Transformations</a>, and <a class="reference external" href="#back-phase-transformations">Back Phase Transformations</a>. All classes have the following common class attributes and methods:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">enabled</span></code> attribute specifies whether the transformation is enabled or not. The value can be changed during runtime to enable or disable execution of the transformation during a model conversion. Default value is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute specifies a unique transformation string identifier. This transformation identifier can be used to enable (disable) the transformation by setting environment variable <code class="docutils literal notranslate"><span class="pre">MO_ENABLED_TRANSFORMS</span></code> (<code class="docutils literal notranslate"><span class="pre">MO_DISABLED_TRANSFORMS</span></code>) with a comma separated list of <code class="docutils literal notranslate"><span class="pre">id</span></code> s. The environment variables override the value of the <code class="docutils literal notranslate"><span class="pre">enabled</span></code> attribute of the transformation. Instead of using <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute value you can add fully defined class name to <code class="docutils literal notranslate"><span class="pre">MO_ENABLED_TRANSFORMS</span></code> (<code class="docutils literal notranslate"><span class="pre">MO_DISABLED_TRANSFORMS</span></code>) variable, <code class="docutils literal notranslate"><span class="pre">extensions.back.NonmalizeToNormalizeL2.NormalizeToNormalizeL2</span></code> for example. It is an optional attribute.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">run_not_recursively</span></code> attribute specifies whether the transformation should be executed in the sub-graphs, for example, body of the <a class="reference internal" href="openvino_docs_ops_infrastructure_TensorIterator_1.html#doxid-openvino-docs-ops-infrastructure-tensor-iterator-1"><span class="std std-ref">TensorIterator</span></a> and the <a class="reference internal" href="openvino_docs_ops_infrastructure_Loop_5.html#doxid-openvino-docs-ops-infrastructure-loop-5"><span class="std std-ref">Loop</span></a>. Default value is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">force_clean_up</span></code> attribute specifies whether the graph clean up should be executed after the transformation. The graph cleanup removes nodes of the graph not reachable from the model inputs. Default value is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">force_shape_inference</span></code> attribute specifies whether the nodes marked with <code class="docutils literal notranslate"><span class="pre">need_shape_inference</span></code> attribute equal to <code class="docutils literal notranslate"><span class="pre">True</span></code> should be re-inferred after the transformation. Model Optimizer sets this attribute automatically for nodes, input(s) of which were changed during the transformation, or you can set this attribute manually in the transformation for the specific nodes. Default value is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>Attribute <code class="docutils literal notranslate"><span class="pre">graph_condition</span></code> specifies a list of functions with one parameter <code class="docutils literal notranslate"><span class="pre">Graph</span></code> object. The transformation is executed if and only if all functions return <code class="docutils literal notranslate"><span class="pre">True</span></code>. If the attribute is not set, no check is performed.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">run_before()</span></code> returns a list of transformation classes which this transformation should be executed before.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">run_after()</span></code> returns a list of transformation classes which this transformation should be executed after.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the transformation types have specific class attributes and methods, which are explained in the corresponding sections of this document.</p>
</div>
<p>Model Optimizer builds a graph of dependencies between registered transformations and executes them in the topological order. To execute the transformation during a proper model conversion phase, Model Optimizer defines several anchor transformations that do nothing. All transformations are ordered with respect to these anchor transformations. The diagram below shows anchor transformations, some of built-in transformations and dependencies between them:</p>
<img alt="Transformations Graph" src="../_images/MO_transformations_graph.png" />
<p>User-defined transformations are executed after the corresponding <code class="docutils literal notranslate"><span class="pre">Start</span></code> and before the corresponding <code class="docutils literal notranslate"><span class="pre">Finish</span></code> anchor transformations by default (if <code class="docutils literal notranslate"><span class="pre">run_before()</span></code> and <code class="docutils literal notranslate"><span class="pre">run_after()</span></code> methods have not been overridden).</p>
<div class="admonition note" id="front-phase-transformations">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PreMiddleStart</span></code> and <code class="docutils literal notranslate"><span class="pre">PostMiddleStart</span></code> anchors were introduced due to historical reasons to refactor the Model Optimizer pipeline, which initially had a hardcoded order of transformations.</p>
</div>
<section id="id11">
<h4>Front Phase Transformations<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>There are several types of a front phase transformation:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#pattern-defined-front-phase-transformations">Pattern-Defined Front Phase Transformations</a> triggered for each sub-graph of the original graph isomorphic to the specified pattern.</p></li>
<li><p><a class="reference external" href="#specific-operation-front-phase-transformations">Specific Operation Front Phase Transformations</a> triggered for the node with a specific <code class="docutils literal notranslate"><span class="pre">op</span></code> attribute value.</p></li>
<li><p><a class="reference external" href="#generic-front-phase-transformations">Generic Front Phase Transformations</a>.</p></li>
<li><p>Manually enabled transformation, defined with a JSON configuration file (for TensorFlow, ONNX, Apache MXNet, and PaddlePaddle models), specified using the <code class="docutils literal notranslate"><span class="pre">--transformations_config</span></code> command-line parameter:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#node-name-pattern-front-phase-transformation">Node Name Pattern Front Phase Transformations</a>.</p></li>
<li><p><a class="reference external" href="#start-end-points-front-phase-transformations">Front Phase Transformations Using Start and End Points</a>.</p></li>
<li><p><a class="reference external" href="#generic-transformations-config-front-phase-transformations">Generic Front Phase Transformations Enabled with Transformations Configuration File</a>.</p></li>
</ol>
</li>
</ol>
<section id="pattern-defined-front-phase-transformations">
<span id="id12"></span><h5>Pattern-Defined Front Phase Transformations<a class="headerlink" href="#pattern-defined-front-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementSubgraph</span></code> and <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementPattern</span></code> as base classes and works as follows:</p>
<ol class="arabic simple">
<li><p>Define a sub-graph to be matched, using a list of nodes with attributes and edges connecting them (edges may also have attributes).</p></li>
<li><p>Model Optimizer searches for all sub-graphs of the original graph, isomorphic to the specified sub-graph (pattern).</p></li>
<li><p>Model Optimizer executes the defined function performing graph transformation for each instance of a matched sub-graph. You can override different functions in the base transformation class so the Model Optimizer works differently:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">replace_sub_graph(self,</span> <span class="pre">graph,</span> <span class="pre">match)</span></code> override the method. In this case Model Optimizer only executes the overridden function, pass the <code class="docutils literal notranslate"><span class="pre">graph</span></code> object and a dictionary describing the matched sub-graph. You are required to write the transformation and connect the newly created nodes to the rest of the graph.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">generate_sub_graph(self,</span> <span class="pre">graph,</span> <span class="pre">match)</span></code> override the method. This case is not recommended for use because it is the most complicated approach. It can be effectively replaced with one of two previous approaches. The explanation of this function is provided in the <a class="reference external" href="#node-name-defined-sub-graph-transformations">Node Name Defined Sub-Graph Transformations</a> section.</p></li>
</ol>
</li>
</ol>
<p>The sub-graph pattern is defined in the <code class="docutils literal notranslate"><span class="pre">pattern()</span></code> function. This function should return a dictionary with two keys: <code class="docutils literal notranslate"><span class="pre">nodes</span></code> and <code class="docutils literal notranslate"><span class="pre">edges</span></code> :</p>
<ul class="simple">
<li><p>The value for the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> key is a list of tuples with two elements.</p>
<ul>
<li><p>The first element is an alias name for a node that will be used to define edges between nodes and in the transformation function.</p></li>
<li><p>The second element is a dictionary with attributes. The key is a name of an attribute that should exist in the node. The value for the attribute can be some specific value to match or a function that gets a single parameter - the attribute value from the node. The function should return the result of attribute comparison with a dedicated value.</p></li>
</ul>
</li>
<li><p>The value for the <code class="docutils literal notranslate"><span class="pre">edges</span></code> key is a list of tuples with two or three elements.</p>
<ul>
<li><p>The first element is the alias name of the node producing a tensor.</p></li>
<li><p>The second element is the alias name of the node consuming the tensor.</p></li>
<li><p>The third element (optional) is the dictionary with expected edge attributes. This dictionary usually contains attributes like <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code>, defining input and output ports.</p></li>
</ul>
</li>
</ul>
<p>Consider the example of a front transformation implemented in the <code class="docutils literal notranslate"><span class="pre">extensions/front/Mish_fusion.py</span></code> file performing fusing of the sub-graph defining the <a class="reference internal" href="openvino_docs_ops_activation_Mish_4.html#doxid-openvino-docs-ops-activation-mish-4"><span class="std std-ref">Mish</span></a> activation function into a single operation:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">Softplus_fusion</span> <span class="n">import</span> <span class="n">SoftplusFusion</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">activation_ops</span> <span class="n">import</span> <span class="n">Mish</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">replacement</span> <span class="n">import</span> <span class="n">FrontReplacementSubgraph</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">subgraph_matcher</span> <span class="n">import</span> <span class="n">SubgraphMatch</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">graph</span> <span class="n">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">rename_nodes</span>


<span class="k">class</span> <span class="n">MishFusion</span><span class="p">(</span><span class="n">FrontReplacementSubgraph</span><span class="p">)</span><span class="o">:</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">The</span> <span class="n">transformation</span> <span class="n">looks</span> <span class="k">for</span> <span class="n">the</span> <span class="n">pattern</span> <span class="n">with</span> <span class="n">Softplus</span> <span class="n">defining</span> <span class="n">the</span> <span class="n">Mish</span> <span class="nl">function</span><span class="p">:</span> <span class="n">Mish</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span> <span class="err">\</span><span class="o">*</span> <a class="reference internal" href="../api/groups/namespaceov_1_1op_1_1util_1_1detail.html#doxid-namespaceov-1-1op-1-1util-1-1detail-1abac0774a36935817fc40c17937983c13"><span class="std std-ref">tanh</span></a><span></span><span class="p">(</span><span class="n">SoftPlus</span><span class="p">(</span><span class="n">x</span><span class="p">)).</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">True</span>  <span class="err">#</span> <span class="n">Transformation</span> <span class="n">is</span> <span class="n">enabled</span><span class="p">.</span>

    <span class="n">def</span> <span class="n">run_after</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">Run</span> <span class="k">this</span> <span class="n">transformation</span> <span class="n">after</span> <span class="s">&quot;SoftplusFusion&quot;</span> <span class="n">transformation</span><span class="p">.</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SoftplusFusion</span><span class="p">]</span>

    <span class="n">def</span> <span class="n">pattern</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">Define</span> <span class="n">pattern</span> <span class="n">according</span> <span class="n">to</span> <span class="n">formulae</span> <span class="n">x</span> <span class="err">\</span><span class="o">*</span> <span class="n">tanh</span><span class="p">(</span><span class="n">SoftPlus</span><span class="p">(</span><span class="n">x</span><span class="p">)).</span>
        <span class="k">return</span> <span class="n">dict</span><span class="p">(</span>
            <span class="n">nodes</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="sc">&#39;mul&#39;</span><span class="p">,</span> <span class="n">dict</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="sc">&#39;Mul&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="sc">&#39;tanh&#39;</span><span class="p">,</span> <span class="n">dict</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="sc">&#39;Tanh&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="sc">&#39;softplus&#39;</span><span class="p">,</span> <span class="n">dict</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="sc">&#39;SoftPlus&#39;</span><span class="p">)),</span>
            <span class="p">],</span>
            <span class="n">edges</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="sc">&#39;softplus&#39;</span><span class="p">,</span> <span class="sc">&#39;tanh&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="sc">&#39;tanh&#39;</span><span class="p">,</span> <span class="sc">&#39;mul&#39;</span><span class="p">),</span>
            <span class="p">])</span>

    <span class="n">def</span> <span class="n">replace_sub_graph</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nl">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="nl">match</span><span class="p">:</span> <span class="p">[</span><span class="n">dict</span><span class="p">,</span> <span class="n">SubgraphMatch</span><span class="p">])</span><span class="o">:</span>  <span class="err">#</span> <span class="n">Entry</span> <span class="n">point</span> <span class="k">for</span> <span class="n">the</span> <span class="n">transformation</span><span class="p">.</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="sc">&#39;mul&#39;</span><span class="p">]</span>  <span class="err">#</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">Node</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">matched</span> <span class="s">&quot;mul&quot;</span> <span class="n">node</span><span class="p">.</span>
        <span class="n">mul_name</span> <span class="o">=</span> <span class="n">mul</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;name&#39;</span><span class="p">,</span> <span class="n">mul</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">softplus</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="sc">&#39;softplus&#39;</span><span class="p">]</span>  <span class="err">#</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">Node</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">matched</span> <span class="s">&quot;softplus&quot;</span> <span class="n">node</span><span class="p">.</span>

        <span class="cp"># Determine the input port of Mul which gets the &#39;input&#39; node output.</span>
        <span class="n">input_port_idx</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">mul</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">get_connection</span><span class="p">().</span><span class="n">get_source</span><span class="p">().</span><span class="n">node</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;op&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;Tanh&#39;</span><span class="p">)</span>

        <span class="cp"># Check that the same tensor is provided as input to Mul and SoftPlus.</span>
        <span class="k">if</span> <span class="n">mul</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="n">input_port_idx</span><span class="p">).</span><span class="n">get_source</span><span class="p">()</span> <span class="o">!=</span> <span class="n">softplus</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">get_source</span><span class="p">()</span><span class="o">:</span>
            <span class="k">return</span>

        <span class="n">mish</span> <span class="o">=</span> <span class="n">Mish</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{}).</span><span class="n">create_node</span><span class="p">()</span>  <span class="err">#</span> <span class="n">Create</span> <span class="n">Mish</span> <span class="n">operation</span><span class="p">.</span>
        <span class="n">mish</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">connect</span><span class="p">(</span><span class="n">mul</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="n">input_port_idx</span><span class="p">).</span><span class="n">get_source</span><span class="p">())</span>  <span class="err">#</span> <span class="n">Connect</span> <span class="n">input</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Mish</span><span class="p">.</span>
        <span class="n">mul</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">get_connection</span><span class="p">().</span><span class="n">set_source</span><span class="p">(</span><span class="n">mish</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="err">#</span> <span class="n">Reconnect</span> <span class="n">outgoing</span> <span class="n">edge</span> <span class="n">from</span> <span class="s">&quot;mul&quot;</span> <span class="n">to</span> <span class="n">Mish</span><span class="p">.</span>

        <span class="cp"># Rename the created Mish operation to have the name of the &quot;mul&quot; node, which produced the value equal to the</span>
        <span class="cp"># Mish output.</span>
        <span class="n">rename_nodes</span><span class="p">([(</span><span class="n">mul</span><span class="p">,</span> <span class="n">mul_name</span> <span class="o">+</span> <span class="sc">&#39;/TBR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">mish</span><span class="p">,</span> <span class="n">mul_name</span><span class="p">)])</span></pre></div></div></section>
<section id="specific-operation-front-phase-transformations">
<span id="id13"></span><h5>Specific Operation Front Phase Transformations<a class="headerlink" href="#specific-operation-front-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementOp</span></code> as base class and works as follows:</p>
<ol class="arabic simple">
<li><p>Define an operation type to trigger the transformation.</p></li>
<li><p>Model Optimizer searches for all nodes in the graph with the attribute <code class="docutils literal notranslate"><span class="pre">op</span></code> equal to the specified value.</p></li>
<li><p>Model Optimizer executes the defined function performing graph transformation for each instance of a matched node. You can override different functions in the base transformation class and Model Optimizer works differently:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">replace_sub_graph(self,</span> <span class="pre">graph,</span> <span class="pre">match)</span></code> override method. In this case, Model Optimizer only executes the overridden function. Pass the <code class="docutils literal notranslate"><span class="pre">graph</span></code> object and a dictionary with a single key <code class="docutils literal notranslate"><span class="pre">op</span></code> with the matched node as value. You are required to write the transformation and connect the newly created nodes to the rest of the graph.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">replace_op(self,</span> <span class="pre">graph,</span> <span class="pre">node)</span></code> override method. In this case, Model Optimizer executes the overridden function. Pass the <code class="docutils literal notranslate"><span class="pre">graph</span></code> object and the matched node as <code class="docutils literal notranslate"><span class="pre">node</span></code> parameter. If the function returns an <code class="docutils literal notranslate"><span class="pre">id</span></code> of some node, then the <code class="docutils literal notranslate"><span class="pre">Node</span></code> with this <code class="docutils literal notranslate"><span class="pre">id</span></code> is connected to the consumers of the matched node. After applying the transformation, the matched node is removed from the graph.</p></li>
</ol>
</li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">FrontReplacementOp</span></code> class provides a simpler mechanism to match a single operation with specific value of the <code class="docutils literal notranslate"><span class="pre">op</span></code> (write the <code class="docutils literal notranslate"><span class="pre">op</span></code> attribute in the class instead of defining a <code class="docutils literal notranslate"><span class="pre">pattern()</span></code> function) attribute and perform the transformation.</p>
<p>Consider an example transformation from the <code class="docutils literal notranslate"><span class="pre">extensions/front/Pack.py</span></code> file, which replaces <code class="docutils literal notranslate"><span class="pre">Pack</span></code> operation from the TensorFlow:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">partial_infer</span><span class="p">.</span><span class="n">utils</span> <span class="n">import</span> <span class="n">int64_array</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">replacement</span> <span class="n">import</span> <span class="n">FrontReplacementOp</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">tf</span><span class="p">.</span><span class="n">graph_utils</span> <span class="n">import</span> <span class="n">create_op_with_const_inputs</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">graph</span> <span class="n">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">rename_nodes</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">concat</span> <span class="n">import</span> <span class="n">Concat</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">unsqueeze</span> <span class="n">import</span> <span class="n">Unsqueeze</span>


<span class="k">class</span> <span class="n">Pack</span><span class="p">(</span><span class="n">FrontReplacementOp</span><span class="p">)</span><span class="o">:</span>
    <span class="n">op</span> <span class="o">=</span> <span class="s">&quot;Pack&quot;</span>  <span class="err">#</span> <span class="n">Trigger</span> <span class="n">transformation</span> <span class="k">for</span> <span class="n">all</span> <span class="n">nodes</span> <span class="n">in</span> <span class="n">the</span> <span class="n">graph</span> <span class="n">with</span> <span class="n">the</span> <span class="n">op</span> <span class="o">=</span> <span class="s">&quot;Pack&quot;</span> <span class="n">attribute</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">True</span>  <span class="err">#</span> <span class="n">Transformation</span> <span class="n">is</span> <span class="n">enabled</span><span class="p">.</span>

    <span class="n">def</span> <span class="n">replace_op</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nl">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="nl">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">Entry</span> <span class="n">point</span> <span class="k">for</span> <span class="n">the</span> <span class="n">transformation</span><span class="p">.</span>
        <span class="cp"># Create a Concat operation with a number of inputs equal to a number of inputs to Pack.</span>
        <span class="n">out_node</span> <span class="o">=</span> <span class="n">Concat</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{</span><span class="sc">&#39;axis&#39;</span><span class="o">:</span> <span class="n">node</span><span class="p">.</span><span class="n">axis</span><span class="p">,</span> <span class="sc">&#39;in_ports_count&#39;</span><span class="o">:</span> <span class="n">len</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">in_ports</span><span class="p">())}).</span><span class="n">create_node</span><span class="p">()</span>
        <span class="n">pack_name</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;name&#39;</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="n">in</span> <span class="n">node</span><span class="p">.</span><span class="n">in_ports</span><span class="p">()</span><span class="o">:</span>
            <span class="cp"># Add dimension of size 1 to all inputs of the Pack operation and add them as Concat inputs.</span>
            <span class="n">unsqueeze_node</span> <span class="o">=</span> <span class="n">create_op_with_const_inputs</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">Unsqueeze</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="o">:</span> <span class="n">int64_array</span><span class="p">([</span><span class="n">node</span><span class="p">.</span><span class="n">axis</span><span class="p">])},</span>
                                                         <span class="p">{</span><span class="sc">&#39;name&#39;</span><span class="o">:</span> <span class="n">node</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;name&#39;</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="sc">&#39;/Unsqueeze&#39;</span><span class="p">})</span>
            <span class="n">node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">get_connection</span><span class="p">().</span><span class="n">set_destination</span><span class="p">(</span><span class="n">unsqueeze_node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">unsqueeze_node</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">connect</span><span class="p">(</span><span class="n">out_node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>

        <span class="cp"># Rename the created Concat operation to have the name of the &quot;pack&quot; node, which produced the value equal to the</span>
        <span class="cp"># Concat output.</span>
        <span class="n">rename_nodes</span><span class="p">([(</span><span class="n">node</span><span class="p">,</span> <span class="n">pack_name</span> <span class="o">+</span> <span class="sc">&#39;/TBR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">out_node</span><span class="p">,</span> <span class="n">pack_name</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">out_node</span><span class="p">.</span><span class="n">id</span><span class="p">]</span>  <span class="err">#</span> <span class="n">Reconnect</span> <span class="n">the</span> <span class="n">Pack</span> <span class="n">operation</span> <span class="n">consumers</span> <span class="n">to</span> <span class="n">get</span> <span class="n">input</span> <span class="n">from</span> <span class="n">Concat</span> <span class="n">instead</span><span class="p">.</span></pre></div></div></section>
<section id="generic-front-phase-transformations">
<span id="id14"></span><h5>Generic Front Phase Transformations<a class="headerlink" href="#generic-front-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>Model Optimizer provides a mechanism to implement generic front phase transformation. This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementSubgraph</span></code> or <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementPattern</span></code> as base classes. Make sure the transformation is enabled before trying to execute it. Then, Model Optimizer executes the <code class="docutils literal notranslate"><span class="pre">find_and_replace_pattern(self,</span> <span class="pre">graph)</span></code> method and provides a <code class="docutils literal notranslate"><span class="pre">Graph</span></code> object as an input.</p>
<p>Consider the example of a generic front transformation from the <code class="docutils literal notranslate"><span class="pre">extensions/front/SqueezeNormalize.py</span></code> file performing normalization of the <a class="reference internal" href="openvino_docs_ops_shape_Squeeze_1.html#doxid-openvino-docs-ops-shape-squeeze-1"><span class="std std-ref">Squeeze</span></a> operation. Older version of the operation had a list of axes to squeeze as an attribute, but now it is a separate input. For backward compatibility, the Model Optimizer operation supports both semantics. Before IR generation, however, the operation should be normalized according to the specification.</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">import</span> <span class="n">logging</span> <span class="n">as</span> <span class="n">log</span>

<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">partial_infer</span><span class="p">.</span><span class="n">utils</span> <span class="n">import</span> <span class="n">int64_array</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">replacement</span> <span class="n">import</span> <span class="n">FrontReplacementPattern</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">graph</span> <span class="n">import</span> <span class="n">Graph</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="k">const</span> <span class="n">import</span> <span class="n">Const</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">error</span> <span class="n">import</span> <span class="n">Error</span>


<span class="k">class</span> <span class="n">SqueezeNormalize</span><span class="p">(</span><span class="n">FrontReplacementPattern</span><span class="p">)</span><span class="o">:</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">Normalizes</span> <span class="n">inputs</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Squeeze</span> <span class="n">layers</span><span class="p">.</span> <span class="n">The</span> <span class="n">layers</span> <span class="n">should</span> <span class="n">have</span> <span class="n">two</span> <span class="nl">inputs</span><span class="p">:</span> <span class="n">the</span> <span class="n">input</span> <span class="n">with</span> <span class="n">data</span> <span class="n">and</span> <span class="n">input</span> <span class="n">with</span> <span class="n">the</span>
    <span class="n">dimensions</span> <span class="n">to</span> <span class="n">squeeze</span><span class="p">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">second</span> <span class="n">input</span> <span class="n">is</span> <span class="n">omitted</span> <span class="n">then</span> <span class="n">all</span> <span class="n">dimensions</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">1</span> <span class="n">should</span> <span class="n">be</span> <span class="n">removed</span><span class="p">.</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">True</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">transformation</span> <span class="n">is</span> <span class="n">enabled</span><span class="p">.</span>

    <span class="n">def</span> <span class="n">find_and_replace_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nl">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">function</span> <span class="n">is</span> <span class="n">called</span> <span class="n">unconditionally</span><span class="p">.</span>
        <span class="k">for</span> <span class="n">squeeze_node</span> <span class="n">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_op_nodes</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="sc">&#39;Squeeze&#39;</span><span class="p">)</span><span class="o">:</span>  <span class="err">#</span> <span class="n">Iterate</span> <span class="n">over</span> <span class="n">all</span> <span class="n">nodes</span> <span class="n">with</span> <span class="n">op</span><span class="o">=</span><span class="sc">&#39;Squeeze&#39;</span><span class="p">.</span>
            <span class="cp"># If the operation has only 1 input node and no &#39;squeeze_dims&#39; Node attribute, then convert the attribute to</span>
            <span class="cp"># the operation input.</span>
            <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">squeeze_node</span><span class="p">.</span><span class="n">in_nodes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">squeeze_node</span><span class="p">.</span><span class="n">has_valid</span><span class="p">(</span><span class="sc">&#39;squeeze_dims&#39;</span><span class="p">)</span><span class="o">:</span>
                <span class="n">dims_node</span> <span class="o">=</span> <span class="n">Const</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{</span><span class="sc">&#39;name&#39;</span><span class="o">:</span> <span class="n">squeeze_node</span><span class="p">.</span><span class="n">id</span> <span class="o">+</span> <span class="sc">&#39;/Dims&#39;</span><span class="p">,</span>
                                          <span class="sc">&#39;value&#39;</span><span class="o">:</span> <span class="n">int64_array</span><span class="p">(</span><span class="n">squeeze_node</span><span class="p">.</span><span class="n">squeeze_dims</span><span class="p">)}).</span><span class="n">create_node</span><span class="p">()</span>
                <span class="n">squeeze_node</span><span class="p">.</span><span class="n">in_port</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">connect</span><span class="p">(</span><span class="n">dims_node</span><span class="p">.</span><span class="n">out_port</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">del</span> <span class="n">squeeze_node</span><span class="p">[</span><span class="sc">&#39;squeeze_dims&#39;</span><span class="p">]</span>
            <span class="cp"># If two inputs already exist, that means the operation is already normalized.</span>
            <span class="n">elif</span> <span class="n">len</span><span class="p">(</span><span class="n">squeeze_node</span><span class="p">.</span><span class="n">in_nodes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="o">:</span>
                <span class="n">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="sc">&#39;The Squeeze node &quot;{}&quot; is already normalized&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">squeeze_node</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
            <span class="cp"># In all other cases, raise an error.</span>
            <span class="k">else</span><span class="o">:</span>
                <span class="n">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sc">&#39;The Squeeze layer &quot;{}&quot; should either have 2 inputs or one input and an &quot;squeeze_dims&quot; &#39;</span>
                            <span class="sc">&#39;attribute&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">squeeze_node</span><span class="p">.</span><span class="n">soft_get</span><span class="p">(</span><span class="sc">&#39;name&#39;</span><span class="p">)))</span></pre></div></div><p>For the details on implementation and how these front phase transformations work, refer to the <code class="docutils literal notranslate"><span class="pre">mo/front/common/replacement.py</span></code> file.</p>
</section>
<section id="node-name-pattern-front-phase-transformations">
<span id="id15"></span><h5>Node Name Pattern Front Phase Transformations<a class="headerlink" href="#node-name-pattern-front-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>TensorFlow uses a mechanism of scope to group related operation nodes. It is a good practice to put nodes performing particular task into the same scope. This approach divides a graph into logical blocks that are easier to review in the TensorBoard. The scope, in fact, just defines a common name prefix for the nodes belonging to it.</p>
<p>For example, Inception topologies contain several types of so-called “Inception blocks”. Some of them are equal to each other, but located in different places of the network. For example, Inception V4 from the <a class="reference external" href="https://github.com/tensorflow/models/tree/master/research/slim">TensorFlow-Slim image classification model library</a> has <code class="docutils literal notranslate"><span class="pre">Mixed_5b</span></code>, <code class="docutils literal notranslate"><span class="pre">Mixed_5c</span></code> and <code class="docutils literal notranslate"><span class="pre">Mixed_5d</span></code> inception blocks with exactly the same nodes, with the same set of attributes.</p>
<p>Consider a situation when these Inception blocks are implemented extremely efficiently using a single Inference Engine operation called <code class="docutils literal notranslate"><span class="pre">InceptionBlock</span></code> and these blocks in the model need to be replaced with instances of this operation. Model Optimizer provides mechanism to trigger the transformation for a sub-graph of operations defined by the node name regular expressions (scope). In this particular case, some of the patterns are: <code class="docutils literal notranslate"><span class="pre">.\*InceptionV4/Mixed_5b</span></code>, <code class="docutils literal notranslate"><span class="pre">.\*InceptionV4/Mixed_5c</span></code> * and <code class="docutils literal notranslate"><span class="pre">.\*InceptionV4/Mixed_5d</span></code>. Each pattern starts with <code class="docutils literal notranslate"><span class="pre">.\*</span></code>, because the <code class="docutils literal notranslate"><span class="pre">InceptionV4</span></code> prefix is added to all nodes names during a model freeze.</p>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.front.tf.replacement.FrontReplacementFromConfigFileSubGraph</span></code> as a base class and works as follows:</p>
<ol class="arabic simple">
<li><p>Prepare a JSON configuration file template defining node names patterns.</p></li>
<li><p>Run Model Optimizer with the <code class="docutils literal notranslate"><span class="pre">--tensorflow_custom_operations_config_update</span></code> command-line parameter, and Model Optimizer adds information about input and output nodes of the specified sub-graphs.</p></li>
<li><p>Model Optimizer executes the defined transformation <strong>only</strong> when you specify the path to the configuration file updated in step 2 using the <code class="docutils literal notranslate"><span class="pre">--transformations_config</span></code> command-line parameter .</p></li>
</ol>
<p>Consider the following possible configuration file template for the Inception Block transformation:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;custom_attributes&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">&quot;attr1_key&quot;</span><span class="o">:</span> <span class="s">&quot;attr1_value&quot;</span><span class="p">,</span>
            <span class="s">&quot;attr2_key&quot;</span><span class="o">:</span> <span class="mi">123456</span>
        <span class="p">},</span>
        <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;InceptionBlockTransformation&quot;</span><span class="p">,</span>
        <span class="s">&quot;instances&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5b&quot;</span><span class="p">,</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5c&quot;</span><span class="p">,</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5d&quot;</span>
        <span class="p">],</span>
        <span class="s">&quot;match_kind&quot;</span><span class="o">:</span> <span class="s">&quot;scope&quot;</span>
    <span class="p">}</span>
<span class="p">]</span></pre></div></div><p>The configuration file contains a list of dictionaries. Each dictionary defines one transformation. Each transformation is defined with several parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> (mandatory) - is a unique identifier of the transformation. It is used in the Python code that implements the transformation to link the class and the transformation description from the configuration file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">match_kind</span></code> (mandatory) - is a string that specifies the matching algorithm. For the node name pattern case, the value should be equal to <code class="docutils literal notranslate"><span class="pre">scope</span></code>. Another possible values are described in the dedicated sections below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">instances</span></code> (mandatory) - specifies instances of the sub-graph to be matched. It contains a list of node names prefixes patterns for the match kind of the <code class="docutils literal notranslate"><span class="pre">scope</span></code> type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_attributes</span></code> (optional) - is a dictionary with attributes that can be used in the transformation code.</p></li>
</ul>
<p>After running Model Optimizer with additional <code class="docutils literal notranslate"><span class="pre">--tensorflow_custom_operations_config_update</span></code> parameter pointing to the template configuration file, the content of the file should be updated with two new sections <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. The file content after the update is as follows:</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;InceptionBlockTransformation&quot;</span><span class="p">,</span>
        <span class="s">&quot;custom_attributes&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">&quot;attr1_key&quot;</span><span class="o">:</span> <span class="s">&quot;attr1_value&quot;</span><span class="p">,</span>
            <span class="s">&quot;attr2_key&quot;</span><span class="o">:</span> <span class="mi">123456</span>
        <span class="p">},</span>
        <span class="s">&quot;instances&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5b&quot;</span><span class="p">,</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5c&quot;</span><span class="p">,</span>
            <span class="s">&quot;.\*InceptionV4/Mixed_5d&quot;</span>
        <span class="p">],</span>
        <span class="s">&quot;match_kind&quot;</span><span class="o">:</span> <span class="s">&quot;scope&quot;</span><span class="p">,</span>
        <span class="s">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">&quot;node&quot;</span><span class="o">:</span> <span class="s">&quot;Branch_2/Conv2d_0a_1x1/Conv2D$&quot;</span><span class="p">,</span>
                    <span class="s">&quot;port&quot;</span><span class="o">:</span> <span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">&quot;node&quot;</span><span class="o">:</span> <span class="s">&quot;Branch_3/AvgPool_0a_3x3/AvgPool$&quot;</span><span class="p">,</span>
                    <span class="s">&quot;port&quot;</span><span class="o">:</span> <span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">&quot;node&quot;</span><span class="o">:</span> <span class="s">&quot;Branch_1/Conv2d_0a_1x1/Conv2D$&quot;</span><span class="p">,</span>
                    <span class="s">&quot;port&quot;</span><span class="o">:</span> <span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">&quot;node&quot;</span><span class="o">:</span> <span class="s">&quot;Branch_0/Conv2d_0a_1x1/Conv2D$&quot;</span><span class="p">,</span>
                    <span class="s">&quot;port&quot;</span><span class="o">:</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="s">&quot;outputs&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">&quot;node&quot;</span><span class="o">:</span> <span class="s">&quot;concat$&quot;</span><span class="p">,</span>
                <span class="s">&quot;port&quot;</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">]</span></pre></div></div><p>The value for <code class="docutils literal notranslate"><span class="pre">inputs</span></code> key is a list of lists describing input tensors of the sub-graph. Each element of the top-level list corresponds to one unique input tensor of the sub-graph. Each internal list describes a list of nodes consuming this tensor and port numbers, where the tensor is consumed. Model Optimizer generates regular expressions for the input nodes names to uniquely identify them in each instance of the sub-graph, defined by the <code class="docutils literal notranslate"><span class="pre">instances</span></code>. Denote these nodes as input nodes of the sub-graph.</p>
<p>In the InceptionV4 topology, the <code class="docutils literal notranslate"><span class="pre">InceptionV4/Mixed_5b</span></code> block has four input tensors from outside of the sub-graph, but all of them are produced by the <code class="docutils literal notranslate"><span class="pre">InceptionV4/Mixed_5a/concat</span></code> node. Therefore, the top-level list of the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> contains one list corresponding to this tensor. Four input nodes of the sub-graph consume the tensor produced by <code class="docutils literal notranslate"><span class="pre">InceptionV4/Mixed_5a/concat</span></code> node. In this case, all four input nodes consume input tensor into “port 0”.</p>
<p>The order of items in the internal list describing nodes does not matter, but the order of elements in the top-level list is important. This order defines how Model Optimizer attaches input tensors to a new generated node if the sub-graph is replaced with a single node. The <code class="docutils literal notranslate"><span class="pre">i</span></code> -th input node of the sub-graph is obtained using <code class="docutils literal notranslate"><span class="pre">match.single_input_node(i)</span></code> call in the sub-graph transformation code. More information about API is given below. If it is necessary to change the order of input tensors, the configuration file can be edited in the text editor.</p>
<p>The value for the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> key is a list describing nodes of the sub-graph producing tensor, that goes outside of the sub-graph or does not have child nodes. Denote these nodes as output nodes of the sub-graph. The order of elements in the list is important. The <code class="docutils literal notranslate"><span class="pre">i</span></code> -th element of the list describes the <code class="docutils literal notranslate"><span class="pre">i</span></code> -th output tensor of the sub-graph, which could be obtained using <code class="docutils literal notranslate"><span class="pre">match.output_node(i)</span></code> call. The order of elements can be manually changed in the configuration file. Model Optimizer uses this order to connect output edges if the sub-graph is replaced with a single node.</p>
<p>For more examples of this type of transformation, refer to the <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_Object_Detection_API_Models.html#doxid-openvino-docs-m-o-d-g-prepare-model-convert-model-tf-specific-convert-object-detection-a-p-i-models"><span class="std std-ref">Converting TensorFlow Object Detection API Models</span></a> guide.</p>
</section>
<section id="front-phase-transformations-using-start-and-end-points">
<span id="start-end-points-front-phase-transformations"></span><h5>Front Phase Transformations Using Start and End Points<a class="headerlink" href="#front-phase-transformations-using-start-and-end-points" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.front.tf.replacement.FrontReplacementFromConfigFileSubGraph</span></code> as a base class and works as follows:</p>
<ol class="arabic simple">
<li><p>Prepare a JSON configuration file that defines the sub-graph to match, using two lists of node names: “start” and “end” nodes.</p></li>
<li><p>Model Optimizer executes the defined transformation <strong>only</strong> when you specify the path to the configuration file using the <code class="docutils literal notranslate"><span class="pre">--transformations_config</span></code> command-line parameter . Model Optimizer performs the following steps to match the sub-graph:</p>
<ol class="arabic simple">
<li><p>Starts a graph traversal from every start node following the direction of the graph edges. The search stops in an end node or in the case of a node without consumers. All visited nodes are added to the matched sub-graph.</p></li>
<li><p>Starts another graph traversal from each non-start node of the sub-graph, i.e. every node except nodes from the “start” list. In this step, the edges are traversed in the opposite edge direction. All newly visited nodes are added to the matched sub-graph. This step is needed to add nodes required for calculation values of internal nodes of the matched sub-graph.</p></li>
<li><p>Checks that all “end” nodes were reached from “start” nodes. If not, it exits with an error.</p></li>
<li><p>Checks that there are no <a class="reference internal" href="openvino_docs_ops_infrastructure_Parameter_1.html#doxid-openvino-docs-ops-infrastructure-parameter-1"><span class="std std-ref">Parameter</span></a> operations among added nodes. If they exist, the sub-graph depends on the inputs of the model. Such configuration is considered incorrect so Model Optimizer exits with an error.</p></li>
</ol>
</li>
</ol>
<p>This algorithm finds all nodes “between” start and end nodes and nodes needed for calculation of non-input nodes of the matched sub-graph.</p>
<p>The example of a JSON configuration file for a transformation with start and end points is <code class="docutils literal notranslate"><span class="pre">extensions/front/tf/ssd_support_api_v1.15.json</span></code> :</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;custom_attributes&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">&quot;code_type&quot;</span><span class="o">:</span> <span class="s">&quot;caffe.PriorBoxParameter.CENTER_SIZE&quot;</span><span class="p">,</span>
            <span class="s">&quot;pad_mode&quot;</span><span class="o">:</span> <span class="s">&quot;caffe.ResizeParameter.CONSTANT&quot;</span><span class="p">,</span>
            <span class="s">&quot;resize_mode&quot;</span><span class="o">:</span> <span class="s">&quot;caffe.ResizeParameter.WARP&quot;</span><span class="p">,</span>
            <span class="s">&quot;clip_before_nms&quot;</span><span class="o">:</span> <span class="nb">false</span><span class="p">,</span>
            <span class="s">&quot;clip_after_nms&quot;</span><span class="o">:</span> <span class="nb">true</span>
        <span class="p">},</span>
        <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;ObjectDetectionAPISSDPostprocessorReplacement&quot;</span><span class="p">,</span>
        <span class="s">&quot;include_inputs_to_sub_graph&quot;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
        <span class="s">&quot;include_outputs_to_sub_graph&quot;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
        <span class="s">&quot;instances&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">&quot;end_points&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s">&quot;detection_boxes&quot;</span><span class="p">,</span>
                <span class="s">&quot;detection_scores&quot;</span><span class="p">,</span>
                <span class="s">&quot;num_detections&quot;</span>
            <span class="p">],</span>
            <span class="s">&quot;start_points&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s">&quot;Postprocessor/Shape&quot;</span><span class="p">,</span>
                <span class="s">&quot;Postprocessor/scale_logits&quot;</span><span class="p">,</span>
                <span class="s">&quot;Postprocessor/Tile&quot;</span><span class="p">,</span>
                <span class="s">&quot;Postprocessor/Reshape_1&quot;</span><span class="p">,</span>
                <span class="s">&quot;Postprocessor/Cast_1&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">&quot;match_kind&quot;</span><span class="o">:</span> <span class="s">&quot;points&quot;</span>
    <span class="p">}</span>
<span class="p">]</span></pre></div></div><p>The format of the file is similar to the one provided as an example in the <a class="reference external" href="#node-name-pattern-front-phase-transformations">Node Name Pattern Front Phase Transformations</a> section. The difference is in the value of the <code class="docutils literal notranslate"><span class="pre">match_kind</span></code> parameter, which should be equal to the <code class="docutils literal notranslate"><span class="pre">points</span></code> and the format of the <code class="docutils literal notranslate"><span class="pre">instances</span></code> parameter, which should be a dictionary with two keys <code class="docutils literal notranslate"><span class="pre">start_points</span></code> and <code class="docutils literal notranslate"><span class="pre">end_points</span></code>, defining start and end node names respectively.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">include_inputs_to_sub_graph</span></code> and <code class="docutils literal notranslate"><span class="pre">include_outputs_to_sub_graph</span></code> parameters are redundant and should be always equal to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This sub-graph match algorithm has a limitation that each start node must have only one input. Therefore, it is not possible to specify, for example, the <a class="reference internal" href="openvino_docs_ops_convolution_Convolution_1.html#doxid-openvino-docs-ops-convolution-convolution-1"><span class="std std-ref">Convolution</span></a> node as input because it has two inputs: data tensor and tensor with weights.</p>
</div>
<p>For other examples of transformations with points, refer to the <a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_Object_Detection_API_Models.html#doxid-openvino-docs-m-o-d-g-prepare-model-convert-model-tf-specific-convert-object-detection-a-p-i-models"><span class="std std-ref">Converting TensorFlow Object Detection API Models</span></a> guide.</p>
</section>
<section id="generic-front-phase-transformations-enabled-with-transformations-configuration-file">
<span id="generic-transformations-config-front-phase-transformations"></span><h5>Generic Front Phase Transformations Enabled with Transformations Configuration File<a class="headerlink" href="#generic-front-phase-transformations-enabled-with-transformations-configuration-file" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation works similarly to the <a class="reference external" href="#generic-front-phase-transformations">Generic Front Phase Transformations</a> but require a JSON configuration file to enable it similarly to <a class="reference external" href="#node-name-pattern-front-phase-transformation">Node Name Pattern Front Phase Transformations</a> and <a class="reference external" href="#start-end-points-front-phase-transformations">Front Phase Transformations Using Start and End Points</a>.</p>
<p>The base class for this type of transformation is <code class="docutils literal notranslate"><span class="pre">mo.front.common.replacement.FrontReplacementFromConfigFileGeneral</span></code>. Model Optimizer executes the <code class="docutils literal notranslate"><span class="pre">transform_graph(self,</span> <span class="pre">graph,</span> <span class="pre">replacement_descriptions)</span></code> method and provides the <code class="docutils literal notranslate"><span class="pre">Graph</span></code> object and dictionary with values parsed from the <code class="docutils literal notranslate"><span class="pre">custom_attributes</span></code> attribute of the provided JSON configuration file.</p>
<p>The example of the configuration file for this type of transformation is <code class="docutils literal notranslate"><span class="pre">extensions/front/tf/yolo_v1_tiny.json</span></code> :</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="s">&quot;TFYOLO&quot;</span><span class="p">,</span>
    <span class="s">&quot;match_kind&quot;</span><span class="o">:</span> <span class="s">&quot;general&quot;</span><span class="p">,</span>
    <span class="s">&quot;custom_attributes&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">&quot;classes&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s">&quot;coords&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s">&quot;num&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s">&quot;do_softmax&quot;</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span></pre></div></div><p>and the corresponding transformation file is <code class="docutils literal notranslate"><span class="pre">./extensions/front/YOLO.py</span></code> :</p>
<div class="highlight"><div class="highlight"><pre><span></span><span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">no_op_eraser</span> <span class="n">import</span> <span class="n">NoOpEraser</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">standalone_const_eraser</span> <span class="n">import</span> <span class="n">StandaloneConstEraser</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">regionyolo</span> <span class="n">import</span> <span class="n">RegionYoloOp</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">front</span><span class="p">.</span><span class="n">tf</span><span class="p">.</span><span class="n">replacement</span> <span class="n">import</span> <span class="n">FrontReplacementFromConfigFileGeneral</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">graph</span> <span class="n">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Graph</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">result</span> <span class="n">import</span> <span class="n">Result</span>
<span class="n">from</span> <span class="n">openvino</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">mo</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">error</span> <span class="n">import</span> <span class="n">Error</span>


<span class="k">class</span> <span class="n">YoloRegionAddon</span><span class="p">(</span><span class="n">FrontReplacementFromConfigFileGeneral</span><span class="p">)</span><span class="o">:</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">Replaces</span> <span class="n">all</span> <span class="n">Result</span> <span class="n">nodes</span> <span class="n">in</span> <span class="n">graph</span> <span class="n">with</span> <span class="n">YoloRegion</span><span class="o">-&gt;</span><span class="n">Result</span> <span class="n">nodes</span> <span class="n">chain</span><span class="p">.</span>
    <span class="n">YoloRegion</span> <span class="n">node</span> <span class="n">attributes</span> <span class="n">are</span> <span class="n">taken</span> <span class="n">from</span> <span class="n">configuration</span> <span class="n">file</span>
    <span class="s">&quot;&quot;&quot;</span>
    <span class="n">replacement_id</span> <span class="o">=</span> <span class="sc">&#39;TFYOLO&#39;</span>  <span class="err">#</span> <span class="n">The</span> <span class="n">identifier</span> <span class="n">matching</span> <span class="n">the</span> <span class="s">&quot;id&quot;</span> <span class="n">attribute</span> <span class="n">in</span> <span class="n">the</span> <span class="n">JSON</span> <span class="n">file</span><span class="p">.</span>

    <span class="n">def</span> <span class="n">run_after</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">NoOpEraser</span><span class="p">,</span> <span class="n">StandaloneConstEraser</span><span class="p">]</span>

    <span class="n">def</span> <span class="n">transform_graph</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nl">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">replacement_descriptions</span><span class="p">)</span><span class="o">:</span>
        <span class="n">op_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="n">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">True</span><span class="p">)</span> <span class="k">if</span> <span class="sc">&#39;op&#39;</span> <span class="n">in</span> <span class="n">d</span> <span class="n">and</span> <span class="n">d</span><span class="p">[</span><span class="sc">&#39;op&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;Result&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">op_output</span> <span class="n">in</span> <span class="nl">op_outputs</span><span class="p">:</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">op_output</span><span class="p">).</span><span class="n">in_node</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">op_params</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">last_node</span><span class="p">.</span><span class="n">id</span> <span class="o">+</span> <span class="sc">&#39;/YoloRegion&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">op_params</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">replacement_descriptions</span><span class="p">)</span>
            <span class="n">region_layer</span> <span class="o">=</span> <span class="n">RegionYoloOp</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">op_params</span><span class="p">)</span>
            <span class="n">region_layer_node</span> <span class="o">=</span> <span class="n">region_layer</span><span class="p">.</span><span class="n">create_node</span><span class="p">([</span><span class="n">last_node</span><span class="p">])</span>
            <span class="cp"># In here, &#39;axis&#39; from &#39;dim_attrs&#39; can be removed to avoid permutation from axis = 1 to axis = 2.</span>
            <span class="n">region_layer_node</span><span class="p">.</span><span class="n">dim_attrs</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="sc">&#39;axis&#39;</span><span class="p">)</span>
            <span class="n">Result</span><span class="p">(</span><span class="n">graph</span><span class="p">).</span><span class="n">create_node</span><span class="p">([</span><span class="n">region_layer_node</span><span class="p">])</span>
            <span class="n">graph</span><span class="p">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">op_output</span><span class="p">)</span></pre></div></div><p>The configuration file has only 3 parameters: <code class="docutils literal notranslate"><span class="pre">id</span></code> identifier of the transformation , <code class="docutils literal notranslate"><span class="pre">match_kind</span></code> (which should be equal to <code class="docutils literal notranslate"><span class="pre">general</span></code>) and the <code class="docutils literal notranslate"><span class="pre">custom_attributes</span></code> dictionary with custom attributes accessible in the transformation.</p>
</section>
</section>
<section id="middle-phase-transformations">
<span id="id16"></span><h4>Middle Phase Transformations<a class="headerlink" href="#middle-phase-transformations" title="Permalink to this headline">¶</a></h4>
<p>There are two types of middle phase transformations:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#pattern-defined-middle-phase-transformations">Pattern-Defined Middle Phase Transformations</a> triggered for each sub-graph of the original graph, isomorphic to the specified pattern.</p></li>
<li><p><a class="reference external" href="#generic-middle-phase-transformations">Generic Middle Phase Transformations</a>.</p></li>
</ol>
<section id="pattern-defined-middle-phase-transformations">
<span id="id17"></span><h5>Pattern-Defined Middle Phase Transformations<a class="headerlink" href="#pattern-defined-middle-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.middle.replacement.MiddleReplacementPattern</span></code> as a base class and works similarly to the <a class="reference external" href="#pattern-defined-middle-phase-transformations">Pattern-Defined Front Phase Transformations</a>. The are two differences:</p>
<ol class="arabic simple">
<li><p>The transformation entry function name is <code class="docutils literal notranslate"><span class="pre">replace_pattern(self,</span> <span class="pre">graph,</span> <span class="pre">match)</span></code>.</p></li>
<li><p>The pattern defining the graph should contain data nodes because the structure of the graph is different between front and middle phases. For more information about the graph structure changes, refer to the <a class="reference external" href="#partial-inference">Partial Inference</a> section.</p></li>
</ol>
<p>For the example of a pattern-defined middle transformation, refer to the <code class="docutils literal notranslate"><span class="pre">extensions/middle/L2NormToNorm.py</span></code> file.</p>
</section>
<section id="generic-middle-phase-transformations">
<span id="id18"></span><h5>Generic Middle Phase Transformations<a class="headerlink" href="#generic-middle-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>Model Optimizer provides a mechanism to implement generic middle phase transformations. This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.middle.replacement.MiddleReplacementPattern</span></code> as a base class and works similarly to the <a class="reference external" href="#generic-front-phase-transformations">Generic Front Phase Transformations</a>. The only difference is that the transformation entry function name is <code class="docutils literal notranslate"><span class="pre">find_and_replace_pattern(self,</span> <span class="pre">graph:</span> <span class="pre">Graph)</span></code>.</p>
<p>For the example of this transformation, refer to the <code class="docutils literal notranslate"><span class="pre">extensions/middle/CheckForCycle.py</span></code> file.</p>
</section>
</section>
<section id="back-phase-transformations">
<span id="id19"></span><h4>Back Phase Transformations<a class="headerlink" href="#back-phase-transformations" title="Permalink to this headline">¶</a></h4>
<p>There are two types of back phase transformations:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#pattern-defined-back-phase-transformations">Pattern-Defined Back Phase Transformations</a> triggered for each sub-graph of the original graph, isomorphic to the specified pattern.</p></li>
<li><p><a class="reference external" href="#generic-back-phase-transformations">Generic Back Phase Transformations</a>.</p></li>
</ol>
<div class="admonition note" id="pattern-defined-back-phase-transformations">
<p class="admonition-title">Note</p>
<p>The graph layout during the back phase is always NCHW. However, during the front and middle phases it could be NHWC if the original model was using it. For more details, refer to <a class="reference external" href="#model-conversion-pipeline">Model Conversion Pipeline</a> section.</p>
</div>
<section id="id20">
<h5>Pattern-Defined Back Phase Transformations<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<p>This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.back.replacement.MiddleReplacementPattern</span></code> as a base class and works the same way as <a class="reference external" href="#pattern-defined-middle-phase-transformations">Pattern-Defined Front Phase Transformations</a>.</p>
<p>For the example of a pattern-defined back transformation, refer to the <code class="docutils literal notranslate"><span class="pre">extensions/back/ShufflenetReLUReorder.py</span></code> file.</p>
</section>
<section id="generic-back-phase-transformations">
<span id="id21"></span><h5>Generic Back Phase Transformations<a class="headerlink" href="#generic-back-phase-transformations" title="Permalink to this headline">¶</a></h5>
<p>Model Optimizer provides mechanism to implement generic back phase transformations. This type of transformation is implemented using <code class="docutils literal notranslate"><span class="pre">mo.back.replacement.BackReplacementPattern</span></code> as a base class and works the same way as <a class="reference external" href="#generic-middle-phase-transformations">Generic Middle Phase Transformations</a>.</p>
<p>For the example of this transformation, refer to the <code class="docutils literal notranslate"><span class="pre">extensions/back/GatherNormalizer.py</span></code> file.</p>
</section>
</section>
</section>
</section>
<section id="see-also">
<span id="id22"></span><h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="openvino_docs_MO_DG_IR_and_opsets.html#doxid-openvino-docs-m-o-d-g-i-r-and-opsets"><span class="std std-ref">Deep Learning Network Intermediate Representation and Operation Sets in OpenVINO™</span></a></p></li>
<li><p><a class="reference internal" href="openvino_docs_MO_DG_prepare_model_convert_model_Converting_Model.html#doxid-openvino-docs-m-o-d-g-prepare-model-convert-model-converting-model"><span class="std std-ref">Converting a Model to Intermediate Representation (IR)</span></a></p></li>
<li><p><a class="reference internal" href="openvino_docs_OV_UG_Model_Representation.html#doxid-openvino-docs-o-v-u-g-model-representation"><span class="std std-ref">OpenVINO Model Representation</span></a></p></li>
<li><p><a class="reference internal" href="openvino_docs_Extensibility_UG_Intro.html#doxid-openvino-docs-extensibility-u-g-intro"><span class="std std-ref">OpenVINO™ Extensibility Mechanism</span></a></p></li>
<li><p><a class="reference internal" href="openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Extending_Model_Optimizer_With_Caffe_Python_Layers.html#doxid-openvino-docs-m-o-d-g-prepare-model-customize-model-optimizer-extending-model-optimizer-with-caffe-python-layers"><span class="std std-ref">Extending Model Optimizer with Caffe Python Layers</span></a></p></li>
</ul>
</section>
</section>


                </div>
            
            
                <div class='prev-next-bottom'>
                  
    <a class='button bttn-sec button-size-l' id="prev-link" href="openvino_docs_Extensibility_UG_VPU_Kernel.html" title="previous page">Prev</a>
    <a class='button bttn-sec button-size-l' id="next-link" href="openvino_docs_MO_DG_prepare_model_customize_model_optimizer_Extending_Model_Optimizer_With_Caffe_Python_Layers.html" title="next page">Next</a>

                </div>
            
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Intel®.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>